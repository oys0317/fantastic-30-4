(function(){var a=this.Giphy={};var b=this.Timer=undefined;var c=this.Utils={};var d=this.Sharing={};var e=this.Analytics={};var f=this.Etc={};var g=this.Images={};var h=this.SearchResults={};var i=this.Nav={};var j=this.Login={};var k=this.Favorites={};var l=this.Search={};var m=this.Tags={};var n=this.Instagram={};var o=this.Browsebar={};var p=this.GifDetail={};var q=this.ArtistLanding={};var r=this.PartnerLanding={};var s=this.HeaderNav={};var t=this.Users={};var u=this.Upload={};var v=this.Newsletter={};var w=this.Facebook={};}).call(this);(function(){var a=Giphy.Analytics={trackSearchResultsView:function(){$.ajax({type:"post",beforeSend:function(a){a.setRequestHeader("Authorization","ApiKey giphy-website:e0771ed7b244ec9c942bea646ad08e6bf514f51a");},url:"/api/v1/analytics/",data:JSON.stringify({"search_term_encoded":$('#search-term').attr("data-term"),"analytic_type":"view"}),dataType:"application/json",contentType:"application/json"});},trackGifDetailView:function(a){$.ajax({type:"post",beforeSend:function(a){a.setRequestHeader("Authorization","ApiKey giphy-website:e0771ed7b244ec9c942bea646ad08e6bf514f51a");},url:"/api/v1/analytics/",data:JSON.stringify({"gif_id":a||$('#gif').attr("data-gif_id"),"analytic_type":"view"}),contentType:"application/json",dataType:"application/json"});},fireEvents:function(a,b){_gaq.push(['_trackPageview',a]);if(!b)window.history.pushState("","",a);if(window.pSUPERFLY)window.pSUPERFLY.virtualPage(a,document.title);else{window._sf_async_config.path=a;window._sf_async_config.title=document.title;window._sf_async_config;}_qevents=[];__qc=undefined;$("#quantcast").remove();var c=$('<script async id="quantcast" src="//edge.quantserve.com/quant.js" type="text/javascript">');_qevents.push({qacct:"p-7A3Yj5VenXEQG"});$('body').append(c);}};})(window,Giphy);(function(){var a=Giphy.Backgrounds={setRandomBackground:function(){if($("#animated-background-wrapper").length>0)$.ajax({type:"get",url:"/ajax/animated-backgrounds/",success:function(a){Giphy.Backgrounds.createBackgrounds(a);}});},createBackgrounds:function(a){var b=a.result;var c=b[Math.floor(Math.random()*b.length)];var d=$('<video></video>').attr({id:"animated-background",preload:"auto",autoplay:true,loop:"loop"}).css('opacity',0);var e=$('<source></source>').attr({src:c.webm_url,type:"video/webm"});var f=$('<source></source>').attr({src:c.mp4_url,type:"video/mp4"});d.append(f);d.append(e);$("#animated-background-wrapper").append(d);var g=$("#attribution");g.find('.byline').attr({"href":c.artist.profile_url});g.find('.avatar').css({"background-image":"url('"+c.artist.avatar_url+"')"});g.find('.username-text').text(c.artist.name);d.on('canplaythrough',function(){d.fadeTo("slow",0.6);g.css({opacity:1});});}};})(window,Giphy);(function(){var a=Giphy.Browsebar={init:function(){this.nextDisplayIndex=0;this.currGifIndex=-1;this.BrowsebarTimeout=undefined;this.CloseAnimationTimeout=undefined;this.DISPLAY_TIMEOUT_DELAY;this.CLOSE_TIMEOUT_DELAY=200;this.pastDisplayIndex=-1;},attachBrowsebarHovers:function(){var b=$("#browsebar a");var c=0;b.mouseenter(function(b){var c=$(this);$("#browsebar a").eq(a.pastDisplayIndex).removeClass("open");$(this).addClass("open");});b.mouseleave(function(a){var b=$(this);setTimeout(closeAnimation=function(){b.removeClass("open");},200);});}};})(window,Giphy);(function(){var a=Giphy.Etc={init:function(){$.ajaxSetup({beforeSend:function(a){a.setRequestHeader("Authorization","ApiKey giphy-website:e0771ed7b244ec9c942bea646ad08e6bf514f51a");}});},reAuthFacebook:function(){FB.login(function(a){if(a.status=='connected'){window.FACEBOOK_PERMISSION=true;window.FB_ACCESS_TOKEN=a.authResponse.accessToken;$.ajax({type:"POST",url:"/login/fb/update",data:{access_token:a.authResponse.accessToken},success:function(a,b,c){},error:function(a,b,c){}});}},{scope:'email,publish_actions'});},checkPermission:function(a){var b=function(){return setTimeout(function(){console.log("etc.js got called");FB.api("/me/permissions",{access_token:window.FB_ACCESS_TOKEN},function(b){for(var c=0;c<b.data.length;c++)if(b.data[c].permission=='publish_actions'&&b.data[c].status=='granted')window.FACEBOOK_PERMISSION=true;if(!window.FACEBOOK_PERMISSION)Giphy.Etc.reAuthFacebook();else a();});},1000);};if(typeof FB!="undefined")b();else window.fbAsyncInit=function(){return b();};},checkLogin:function(a){if(window.HAS_CHECKED_LOGIN)a.success();$.ajax({type:"GET",url:"/login/check/",dataType:"json",success:function(b){window.LOGGED_IN=b.result.logged_in;window.IS_PARTNER=b.result.is_partner;window.IS_ARTIST=b.result.is_artist;window.HAS_CHECKED_LOGIN=true;window.FB_AUTH=b.result.fb_auth;window.FB_ID=b.result.fb_id;if(window.FB_AUTH)window.FB_ACCESS_TOKEN=b.result.fb_access_token;for(var c=0;c<b.result.messages.length;c++){var d=b.result.messages[c];var e=d.tags;var f=d.text;var g=$("<div>");g.addClass("flash");g.addClass(e);g.text(f);$("#messages").append(g);setTimeout(function(){$('.flash').fadeOut('slow');},3000);}$(window).trigger("login:check");if(a!=undefined&&a.success!=undefined)a.success();},error:function(a,b,c){window.LOGGED_IN=false;window.IS_PARTNER=false;}});return this;}};})(window,Giphy);(function(a){var b={el:$({}),trigger:function(a){if(!a)return;var b=Math.max(0,arguments.length-1);var c=Array(b);for(var d=0;d<b;d++)c[d]=arguments[d+1];this.el.trigger(a,c);},on:function(a,b,c){if(!a||!b)return;this.el.on(a+'.giphy-events',function(){b.apply(c,arguments);});},off:function(a){if(!a)return;this.el.off(a+'.giphy-events');}};a.Events=b;})(Giphy);(function(){var a=Giphy.Favorites={nav:function(){$("#favorites-nav").click(function(a){if(!window.LOGGED_IN){window.location="https://"+document.domain+"/login/?next=/favorites";return false;}});},permalink:function(){if($(".gif-detail").length>0){var a=$("#gif").attr("data-gif_id");$.ajax({type:"get",url:"/favorites/"+a+"/",success:function(a){$(".favorite").each(function(b){var c=$(this);if(a.result.has_favorited){c.addClass('favorited');c.addClass('_011_heart_red');c.removeClass('_012_heart_white');}else{c.removeClass('favorited');c.addClass('_012_heart_white');c.removeClass('_011_heart_red');}c.show();});}});$(".favorite").unbind('click').bind('click',function(a){if(!window.LOGGED_IN){_gaq.push(['_trackEvent','Favorites','ModalOpened']);_gaq.push(['_trackEvent','Favorites','HeartClick','LoggedOut']);window.location="https://"+document.domain+"/login/?next="+location.pathname+"&ref=fave";return false;}var b=$(this);_gaq.push(['_trackEvent','Favorites','HeartClick','LoggedIn',$(this).attr('data-gif_id')]);if(!b.hasClass('favorited'))$(".favorite").each(function(){$(this).addClass('favorited');$(this).addClass('_011_heart_red');$(this).removeClass('_012_heart_white');});else $(".favorite").each(function(){$(this).removeClass('favorited');$(this).addClass('_012_heart_white');$(this).removeClass('_011_heart_red');});$.ajax({type:"post",url:"/favorites/"+$(this).attr('data-gif_id')+"/",success:function(a){if(a.result.has_favorited)showSuccess("Added to favorites!");else showSuccess("Removed from favorites!");}});return false;});$(".favorite").mouseenter(function(a){var b=$(this);if(!b.hasClass('favorited')){b.addClass('_011_heart_red');b.removeClass('_012_heart_white');}else{b.removeClass('_011_heart_red');b.addClass('_012_heart_white');}});$(".favorite").mouseleave(function(a){var b=$(this);if(!b.hasClass('favorited')){b.removeClass('_011_heart_red');b.addClass('_012_heart_white');}else{b.addClass('_011_heart_red');b.removeClass('_012_heart_white');}});}}};})(window,Giphy);(function(){var a=Giphy.Facebook={search:function(a){$(".choice.active").removeClass("active");$("#searchresults").html('');$("#no-results").hide();$("#searchresults").show();$("#searchresults").addClass("loading");$.ajax({url:"/ajax/fb/tag/"+a,method:"GET",success:function(a){$("#searchresults").removeClass("loading");$("#searchresults").html(a);Giphy.SearchResults.attachInfiniteScroll();Giphy.Images.sizeImages("#searchresults");var b=$(".hoverable li, .row-tag, .featured-item, .featured-user");if(b.length==0){$("#no-results").show();$("#searchresults").hide();}else{$("#no-results").hide();$("#searchresults").show();$(".gifs-gif").each(function(){$(this).attr('src',$(this).data('animated'));});}}});},checkPermissions:function(a,b,c){var d=function(){console.log("fb.js got called");FB.api('/me/permissions',function(d){for(var e=0;e<d.data.length;e++)if(d.data[e].permission=='publish_actions'){window.ACCESS_TOKEN=a;if(b!==undefined)b();return false;}if(c===undefined)FB.login(function(a){if(a.status=='connected')Giphy.Facebook.checkPermissions(a.authResponse.accessToken,b,true);},{scope:'publish_actions, email'});});};if(typeof FB!="undefined")d();else window.fbAsyncInit=function(){return d();};},setup:function(){Giphy.Facebook.search("happy");$(".choice").first().addClass("active");$(document).bind("search:success",function(a,b){$("#searchresults").show();$("#no-results").hide();});$(document).bind('search:execute',function(a){$("#no-results").hide();});$(document).bind('search:dont_display',function(a){$(document).trigger("search:clear");});$(".no-result").on('click',function(){$("#search-box").val($(this).text());$("#placeholder").hide();Giphy.Facebook.search($(this).text());return false;});$(document).bind('images:done_sizing',function(a,b){$("a.gif-link").off('click').on('click',function(){var a=$(this).data('id');if(!window.ACCESS_TOKEN)FB.getLoginStatus(function(b){if(b.status=='connected')Giphy.Facebook.checkPermissions(b.authResponse.accessToken,function(){Giphy.Facebook.showModal(a);});else FB.login(function(b){if(b.status=='connected')Giphy.Facebook.checkPermissions(b.authResponse.accessToken,function(){Giphy.Facebook.showModal(a);});else{}},{scope:'publish_actions, email'});});else Giphy.Facebook.showModal(a);return false;});$(".tags").hide();});$('.choice').on('click',function(){$("#search-box").val($(this).data("tag-encoded"));$("#placeholder").hide();Giphy.Facebook.search($(this).data("tag-encoded"));$(this).addClass('active');return false;});},showModal:function(a){$("#fb_status").val('');$("#fb_details").show();$("#fb_response").hide();$("#fb_submit").show();$("#fb_submitting").hide();$("#fb_status").focus();$("#fb_post").off('click').on('click',function(){$("#fb_submit").hide();$("#fb_submitting").show();$.ajax({url:"/ajax/fb/upload/",method:"POST",data:{"gif_id":a,"status":$("#fb_status").val(),"token":window.ACCESS_TOKEN},success:function(a){$("#fb_submit").hide();$("#fb_submitting").hide();$("#fb_details").hide();$("#fb_response").show();},error:function(){$("#fb_submit").hide();$("#fb_submitting").hide();$("#fb_response").show();$("#fb_response_text").text("Oh no! Something went wrong. Please try posting your status update again.");}});});$("#fb_ok").off('click').on('click',function(){$.modal.close();});$("#fb_cancel").off('click').on('click',function(){$.modal.close();});$("#gif_id").val(a);$("#gif_preview").attr("src","");$("#gif_preview").attr("src","http://giphygifs.s3.amazonaws.com/media/"+a+"/giphy.gif");$("#fb_modal").modal({overlay:"#000",opacity:0.8,modalClass:"lolwhatever",showClose:false,showSpinner:false,zIndex:101});}};})(window,Giphy);(function(a,b){var c={__socialLinkClick:function(a){var b=$(a.currentTarget);var c=b.closest('.social-link');var d=c.data();this._sendAnalytics(d.type);if(d.popup){a.preventDefault();this.openPopup(b.attr('href'),d.popupWidth,d.popupHeight);}},__showMoreSocialLinksClick:function(a){a.preventDefault();$(a.currentTarget).remove();this.$socialLinks.removeClass('truncated');},__showMoreActionsClick:function(a){a.preventDefault();this.$moreOptions.toggleClass('hide');var b=this.$moreOptions.hasClass('hide');$(a.currentTarget).text(b?'More options':'Fewer options');if(b)this.$moreOptions.find('.copy-paste .checkmark').remove();},__navButtonClick:function(a){a.preventDefault();var b=$(a.currentTarget);this._toggleAdvancedOptions(b.attr('href')==='#gif-advanced-actions');},__autoplayToggle:function(a,b){var c=this.$iframeEmbedInput.val();var d=this.$jsEmbedInput.val();if(b){c=c.replace("?playOnHover=true","");d=d.replace("var _giphy_play_on_hover = true;","");}else{c=c.replace(/embed\/([a-zA-Z0-9-_]*)/,"embed\/$1?playOnHover=true");d=d.replace("var _giphy","var _giphy_play_on_hover = true; var _giphy");}this.$iframeEmbedInput.val(c);this.$jsEmbedInput.val(d);},_sendAnalytics:function(a){a=a||'';$.ajax({url:'/api/v1/analytics/',type:'POST',contentType:'application/json',dataType:'application/json',beforeSend:function(a){a.setRequestHeader('Authorization','ApiKey giphy-website:e0771ed7b244ec9c942bea646ad08e6bf514f51a');},data:JSON.stringify({'gif_id':this.gifId,'analytic_type':a+'_share'})});},_truncateSocialLinks:function(){if(!this.truncateSocialLinks||!this.$socialLinks.length)return;var a=this.$socialLinks.find('.social-link');var b=3;if(a.length>b){var c=$('<li class="show-more"><i class="ss-icon ss-ellipsis"></i></li>');a.filter(':gt('+(b-1)+')').addClass('hide');this.$socialLinks.addClass('truncated').append(c);}},_toggleAdvancedOptions:function(a){a=a||false;this.$navButtons.removeClass('active');if(a){this.$navButtons.filter('[href="#gif-advanced-actions"]').addClass('active');this.$shareActions.hide();this.$advandedActions.show();}else{this.$navButtons.filter('[href="#gif-share-actions"]').addClass('active');this.$shareActions.show();this.$advandedActions.hide();}},_truncateEmbedOptions:function(){if(!this.$moreOptions.length)return;var a=$('<a class="show-more-actions" href="#">More options</a>');this.$moreOptions.addClass('hide').before(a);},_initializeTwitterUpload:function(){if(a.Utils.getParameterByName("twit_auth")){this._toggleAdvancedOptions(true);$('html, body').animate({scrollTop:this.$advandedActions.offset().top},100);}this.subviews.uploadTwitter=a.UploadToTwitter.initialize({el:this.$el.find('#upload-to-twitter'),gifId:this.gifId});},initialize:function(b){b=b||{};this.options=b;this.shareUrl='';this.permalinkUrl='';this.gifId='';this.popupWidth=b.popupWidth||540;this.popupHeight=b.popupHeight||600;this.scrollbarWidth=a.Utils.getScrollbarWidth()||0;this.truncateSocialLinks=b.truncateSocialLinks||false;this.uploadToTwitter=null;this.gifShortener=null;this.subviews={};this.$el=$(b.el||'.gif-actions');this.render();return this;},cacheSelectors:function(){if(!this.$el.length)return;this.$socialLinks=this.$el.find('.gif-social-links');this.$moreOptions=this.$el.find('.more-actions');this.$copyInputs=this.$el.find('input[data-copy="true"]');this.$autoplayToggle=this.$el.find('.autoplay-toggle');this.$iframeEmbedInput=this.$el.find('#iframe-embed-code');this.$jsEmbedInput=this.$el.find('#optimized-embed-code');this.$navButtons=this.$el.find('.gif-actions-nav .nav-button');this.$shareActions=this.$el.find('#gif-share-actions');this.$advandedActions=this.$el.find('#gif-advanced-actions');},render:function(){if(!this.$el.length)return;this.cacheSelectors();var b=this.$el.data();this.shareUrl=this.options.shareUrl||b.shareUrl;this.permalinkUrl=this.options.permalinkUrl||b.permalinkUrl;this.gifId=this.options.gifId||b.gifId;this.$el.removeClass('no-animate');this._toggleAdvancedOptions(false);if(this.truncateSocialLinks)this._truncateSocialLinks();this._truncateEmbedOptions();this.subviews.instagramModal=a.InstagramModal.initialize({gifId:this.gifId});this.subviews.gifShortener=a.GifShortener.initialize({el:this.$el.find('#gif-shortener'),gifId:this.gifId});this._initializeTwitterUpload();this.$el.on('click.gif-sharing','.social-link a',$.proxy(this.__socialLinkClick,this));this.$el.on('click.gif-sharing','.show-more',$.proxy(this.__showMoreSocialLinksClick,this));this.$el.on('click.gif-sharing','.show-more-actions',$.proxy(this.__showMoreActionsClick,this));this.$el.on('click.gif-sharing','.gif-actions-nav .nav-button',$.proxy(this.__navButtonClick,this));if(this.$autoplayToggle.length)this.$autoplayToggle.on('toggle.gif-sharing',$.proxy(this.__autoplayToggle,this));},remove:function(){this.$el.off('.gif-sharing');if(this.$autoplayToggle&&this.$autoplayToggle.length)this.$autoplayToggle.off('.gif-sharing');for(key in this.subviews){var a=this.subviews[key];a.remove();}},openPopup:function(a,b,c){if(!a)return;var d='';var e={height:c||this.popupHeight,left:0,location:0,menubar:0,resizable:1,status:0,toolbar:0,top:0,width:(b||this.popupWidth)+this.scrollbarWidth};for(var f in e)d+=f+'='+e[f]+',';window.open(a,'_blank',d);}};var d={__keyup:function(a){var b=this.$input.val()||'';if(a.which===13&&b.trim().length>0)this.shortenUrl(b);},__focus:function(){this.$input.select();},__input:function(){var a=this.$input.val()||'';this.$button.toggleClass('disabled',a.trim().length<1);this._reset();},__copy:function(){if(!this.isShortened)return;window.showSuccess('Copied to clipboard!');},__click:function(a){a.preventDefault();var b=$(a.currentTarget);if(b.hasClass('disabled')||b.hasClass('saving'))return;this.shortenUrl(this.$input.val());},__success:function(a){if(!a||!a.result||a.result.code!==200){this.__error();return;}this.$input.val(a.result.short_url);this.$input.focus().select();this.isShortened=true;this.$el.addClass('saved');this.$button.removeClass('saving').addClass('saved').text(this.savedLabel);},__error:function(){this.$button.removeClass('saving').addClass('error').text(this.errorLabel);window.showError('An error has occurred.');},_reset:function(){this.isShortened=false;this.$el.removeClass('saved');this.$button.removeClass('saving saved error').text(this.label);},initialize:function(a){a=a||{};this.gifId=a.gifId||$('#gif').data('gif_id');this.savingLabel=a.savingLabel||'Shortening';this.savedLabel=a.savedLabel||'Booyah!';this.errorLabel=a.errorLabel||'Oops...';this.label='';this.isShortened=false;this.$el=$(a.el||'#gif-shortener');this.$input=$();this.$button=$();this.render();return this;},render:function(){if(!this.$el.length)return;this.$input=this.$el.find('.gif-shortener-input');this.$button=this.$el.find('.gif-shortener-button');this.label=this.$button.text();this.$el.on('keyup.gif-shortener','.gif-shortener-input',$.proxy(this.__keyup,this));this.$el.on('click.gif-shortener','.gif-shortener-input',$.proxy(this.__focus,this));this.$el.on('copy.gif-shortener','.gif-shortener-input',$.proxy(this.__copy,this));this.$el.on('input.gif-shortener','.gif-shortener-input',$.proxy(this.__input,this));this.$el.on('click.gif-shortener','.gif-shortener-button',$.proxy(this.__click,this));},remove:function(){if(!this.$el.length)return;this._reset();this.$el.off('.gif-shortener').remove();},shortenUrl:function(a){a=a||'';if(!a.trim().length)return;this.$button.addClass('saving').text(this.savingLabel);$.ajax({type:'POST',url:'//'+window.ASSET_DOMAIN+'/ajax/shorturl/create/',data:{gif_id:this.gifId,redirect_to:a},success:$.proxy(this.__success,this),error:$.proxy(this.__error,this)});}};var e={__input:function(){this._reset();this.updateTweet();},__blur:function(){var a=this.$input.val();var b=this.$input.data();if(b.originalValue&&!a.length){this.$text.html('<i>'+b.originalValue+'</i>&nbsp;');this.updateTweet();}},__keydown:function(a){if(a.which===13){a.preventDefault();a.stopPropagation();this.tweet();return false;}},__click:function(a){a.preventDefault();var b=$(a.currentTarget);if(b.hasClass('disabled')||b.hasClass('too-long')||b.hasClass('saving'))return;this.tweet();},__logoutClick:function(a){a.preventDefault();$.removeCookie('giphy-twitter-upload');window.location=a.currentTarget.href;},_reset:function(){this.$button.removeClass('saved saving').text(this.buttonLabel);this.$text.removeClass('readonly');},_setInputHeight:function(){if(!this.$preview.length)return;var a=this.$preview.attr('src');var b=new Image();var c=this.$preview.width();b.onload=$.proxy(function(){var a=c/b.width;this.$text.height(Math.round(b.height*a)-20);},this);b.src=a;},initialize:function(a){a=a||{};this.gifId=a.gifId||$('#gif').data('gif_id');this.maxCharacters=a.maxCharacters||117;this.cookie=$.cookie("giphy-twitter-upload");this.tweetingLabel=a.tweetingLabel||"Tweetin'";this.successLabel=a.successLabel||'Tweeted!';this.buttonLabel='';this.linkText='';this.$el=$(a.el||'#upload-to-twitter');this.$count=$();this.$button=$();this.$preview=$();this.render();return this;},render:function(){if(!this.$el.length)return;this.$count=this.$el.find('.tweet-count');this.$button=this.$el.find('.tweet-button');this.$input=this.$el.find('.tweet-input');this.$text=this.$el.find('.tweet-text');this.$loginButtons=this.$el.find('.login-buttons');this.$preview=this.$el.find('.image-preview');this.buttonLabel=this.$button.text();this.linkText=this.$input.val();this._setInputHeight();this.$el.on('click.upload-twitter','.tweet-button',$.proxy(this.__click,this));this.$el.on('input.upload-twitter','.tweet-text',$.proxy(this.__input,this));this.$el.on('keydown.upload-twitter','.tweet-text',$.proxy(this.__keydown,this));this.$el.on('blur.upload-twitter','.tweet-text',$.proxy(this.__blur,this));this.$el.on('click.upload-twitter','.logout',$.proxy(this.__logoutClick,this));this.updateTweet();this.updateLoginStatus();},remove:function(){this.$el.off('.upload-twitter');},tweet:function(){var a=this.$input.val();if(!a||a.length>this.maxCharacters)return;this.$button.addClass('saving').text(this.tweetingLabel);this.$text.addClass('readonly');$.ajax({type:'POST',url:'/ajax/twitter_upload',data:{gif_id:this.gifId,status:a},success:$.proxy(function(a){if(!a.result||!a.result.response||!a.result.response.meta){this._reset();return;}var b=a.result.response.meta;if(b.status&&b.status===200){this.$button.removeClass('saving').addClass('saved').text(this.successLabel);this.$text.removeClass('readonly');window.showSuccess('Your tweet has been sent.');}else if(b.msg){this._reset();window.showError('ERROR: '+b.msg);}if(b.status&&b.status===400){this.cookie=null;this._reset();this.updateLoginStatus();}},this),error:$.proxy(function(){this._reset();window.showError('An error has occurred. Please try again later.');},this)});},updateTweet:function(){var a=this.$text.text().replace('&nbsp;',' ');var c=[];var d=this.maxCharacters;this.$input.val(a);if(b)c=b.txt.extractUrls(a);for(var e=0;e<c.length;e++){a=a.replace(c[e],'');if(c[e].toLowerCase().substring(0,5)=='http:')d-=22;else d-=23;}d-=a.length;this.$count.text('('+d+')').toggleClass('too-long',d<0);this.$button.toggleClass('too-long',d<0);},updateLoginStatus:function(){if(this.cookie){this.$el.addClass('logged-in');this.$button.removeClass('disabled');this.$text.removeClass('readonly');}else{this.$el.removeClass('logged-in');this.$button.addClass('disabled');this.$text.addClass('readonly');}}};var f={__keydown:function(a){if(a.which===13){a.preventDefault();this.submitEmail();}},__click:function(a){a.preventDefault();this.submitEmail();},initialize:function(a){a=a||{};this.gifId=a.gifId||$('#gif').data('gif_id');this.url=a.url||'/ajax/instashare/';this.savingButtonText=a.savingButtonText||'Sending';this.successButtonText=a.successButtonText||'Sent!';this.successText=a.successText||'Success! Check your email in about 5 minutes. We sent you a GIF you can upload to Instagram.';this.errorText=a.errorText||'UH OH! Something went wrong. Try again?';this.$body=$('body');this.render();return this;},render:function(){this.$body.on('keydown.instagram-modal','.rad-modal .instagram-input',$.proxy(this.__keydown,this));this.$body.on('click.instagram-modal','.rad-modal .instagram-send-button',$.proxy(this.__click,this));},remove:function(){this.$body.off('.instagram-modal');},submitEmail:function(){var b=this.$body.find('.rad-modal .instagram-input');var c=this.$body.find('.rad-modal .instagram-send-button');var d=c.text();var e=b.val();if(!e||e.indexOf('@')<0)return;c.addClass('saving').text(this.savingButtonText);$.ajax({type:'POST',url:this.url,data:{'gif_id':this.gifId,'to':e},success:$.proxy(function(b){if(b.result&&b.result.code===200){window.showSuccess('Success! Check your email in about 5 minutes. We sent you a GIF you can upload to Instagram.');c.removeClass('saving').addClass('saved').text(this.successButtonText);a.Events.trigger('radmodal:close');}else{window.showError(this.errorText);c.removeClass('saving').text(d);}},this),error:$.proxy(function(){window.showError(this.errorText);c.removeClass('saving').text(d);},this)});}};a.GifActions=c;a.GifShortener=d;a.UploadToTwitter=e;a.InstagramModal=f;})(Giphy,twttr);(function(a,b){var c={__editToggle:function(){this.fetchGif(document.location);},__editClick:function(b){b.preventDefault();if(a.GifEdit)a.GifEdit.toggleEditMode(true);},_addEditButton:function(){var a=this.$el.find('.gif-navigation');this.$editButton.remove();if(a.length){this.$editButton.attr('href',this.gifData.editUrl);a.prepend(this.$editButton);}},initialize:function(a){a=a||{};this.$win=$(window);this.$body=$('body');this.$el=$('#gif-detail');this.$gif=$();this.$editButton=$('<a class="gif-button edit"></a>');this.gifData={};this.subviews={};this.isMp4=false;this.isEdit=false;this.render();},initializeEditMode:function(){if(!a.GifEdit)return;this.isEdit=true;this._addEditButton();a.GifEdit.initialize({gifId:this.gifData.gif_id,editUrl:this.gifData.editUrl,absoluteUrl:this.gifData.absoluteUrl});},render:function(){if(!this.$el.length)return;this.$gif=this.$el.find('#gif');this.$el.removeClass('no-animate');this.gifData=this.$gif.data();this.html5Player();this.subviews.favorite=a.GifFavorite.initialize({el:this.$el,gifId:this.gifData.gif_id});if(!this.isMp4)this.subviews.modes=a.GifModes.initialize({el:this.$el,gif:this.$gif,baseUrl:this.gifData.absoluteUrl});if(a.GifActions)a.GifActions.initialize({truncateSocialLinks:false});if(a.Analytics)a.Analytics.trackGifDetailView(this.gifData.gif_id);if(this.isEdit)this._addEditButton();this.$el.on('click.gif-detail','.gif-navigation .edit',$.proxy(this.__editClick,this));a.Events.on('gifedit:toggle',$.proxy(this.__editToggle,this));},remove:function(){this.$el.off('.gif-detail').removeClass('loading');this.gifData={};this.subviews={};this.isMp4=false;if(this.subviews.favorite){this.subviews.favorite.remove();this.subviews.favorite=null;}if(this.subviews.modes){this.subviews.modes.remove();this.subviews.modes=null;}if(a.GifActions)a.GifActions.remove();a.Events.off('gifedit:toggle');},html5Player:function(){var b=a.Utils.getParameterByName('html5');var c=a.Utils.canPlayMP4();var d=this.$gif.closest('.gif-figure');if(!b||b!=='true'||!c)return;var e=$('<video>',{id:'gif-mp4',height:this.$gif.height(),width:this.$gif.width(),poster:this.gifData.still,autoplay:true,loop:true});e.data('original-height',this.gifData.originalHeight).data('original-width',this.gifData.originalWidth).append('<source src="'+this.gifData.mp4_url+'" type="video/mp4"></source>');d.empty().append(e);this.isMp4=true;},fetchGif:function(b){if(!b)return;this.$el.addClass('loading');$.ajax({type:'GET',url:b,success:$.proxy(function(c){var d=$(c);var e=d.find('#gif-detail');var f=d.filter('title').text();if(e.length){if(window.history&&b!==this.gifData.absoluteUrl){window.history.pushState({},f,b);document.title=f;}this.remove();var g=e.children('#gif-wrap');this.$el.children('#gif-wrap').html(g.html());var h=e.children('.gif-actions');this.$el.children('.gif-actions').html(h.html());var i=e.find('.gif-info-wrapper');this.$el.find('.gif-info-wrapper').html(i.html());this.render();a.Globals.refresh();}},this),error:function(){}});}};var d={__click:function(a){if(!window.LOGGED_IN)return;a.preventDefault();var c=!this.$favoriteButtons.data('favorited');this.$favoriteButtons.removeClass('is-favorite').toggleClass('favorited',c).toggleClass('unfavorited',!c);b.push(['_trackEvent','Favorites','HeartClick','LoggedIn',this.gifId]);this.updateStatus();},__success:function(a,b){if(!b.result)return;var c=b.result.has_favorited;this.$favoriteButtons.show().toggleClass('is-favorite',c).data('favorited',c);if(a)window.showSuccess(c?'Added to your favorites!':'Removed from your favorites.');},initialize:function(a){a=a||{};this.$el=$(a.el||'.gif-detail');this.$favoriteButtons=$();this.gifId=a.gifId||$('#gif').data('gif_id');this.render();},render:function(){if(!this.$el.length)return;this.$favoriteButtons=this.$el.find('.favorite').hide();this.$el.on('click.gif-favorite','.favorite',$.proxy(this.__click,this));this.getStatus();},remove:function(){this.$el.off('.gif-favorite');},getStatus:function(){$.ajax({type:'GET',url:'/favorites/'+this.gifId+'/',success:$.proxy(this.__success,this,false)});},updateStatus:function(){$.ajax({type:'POST',url:'/favorites/'+this.gifId+'/',success:$.proxy(this.__success,this,true)});}};var e={__tileClick:function(a){a.preventDefault();this.renderOverlay(true);},__fullscreenClick:function(a){a.preventDefault();this.renderOverlay();},__windowKeydown:function(a){if(a.which===27)this.removeOverlay();},_updatePositionStyles:function(){if(!this.isOverlayed||!this.$gif.length)return;var a=this.$gif.offset();this.$overlay.css({height:this.$gif.height(),width:this.$gif.width(),left:a.left,top:a.top-this.$win.scrollTop()});},_updateUrl:function(a){if(!window.history)return;var b=this.baseUrl;if(this.isOverlayed)b+=a?'/tile':'/fullscreen';window.history.replaceState({},document.title,b);},initialize:function(a){a=a||{};this.$win=$(window);this.$body=$('body');this.$el=$(a.el||'.gif-detail');this.$gif=$(a.gif||'#gif');this.$overlay=$('<div class="gif-mode-overlay"></div>');this.animationDuration=a.animationDuration||400;this.baseUrl=a.baseUrl||window.location.href.replace(/\/+$/,"");this.isOverlayed=false;this.render();},render:function(){if(!this.$el.length)return;this.$el.on('click.gif-modes','.gif-button.tile',$.proxy(this.__tileClick,this));this.$el.on('click.gif-modes','.gif-button.fullscreen',$.proxy(this.__fullscreenClick,this));},renderOverlay:function(a){if(!this.$gif.length||!this.$gif.attr('src'))return;a=a||false;var b=this.$gif.width()+'px '+this.$gif.height()+'px';var c=this.$gif.data();this.isOverlayed=true;this._updatePositionStyles();this.$overlay.removeClass('animate').toggleClass('tile',a).toggleClass('fullscreen',!a).css({backgroundImage:'url('+this.$gif.attr('src')+')',backgroundSize:a?b:'cover'}).appendTo(this.$body).one('click',$.proxy(this.removeOverlay,this));this.$win.on('scroll.gif-modes',$.proxy(this._updatePositionStyles,this));this.$win.on('resize.gif-modes',$.proxy(this._updatePositionStyles,this));this.$win.on('keydown.gif-modes',$.proxy(this.__windowKeydown,this));setTimeout($.proxy(function(){this.$overlay.addClass('animate');this._updateUrl(a);if(a)this.$overlay.css('background-size',c.originalWidth+'px '+c.originalHeight+'px');},this),100);},removeOverlay:function(){this.$overlay.removeClass('animate');this.$win.off('.gif-modes');this.isOverlayed=false;this._updateUrl();if(this.$overlay.hasClass('tile'))this.$overlay.css('background-size',this.$gif.width()+'px '+this.$gif.height()+'px');setTimeout($.proxy(function(){this.$overlay.removeClass('tile fullscreen').remove();},this),this.animationDuration);},remove:function(){this.removeOverlay();this.$el.off('.gif-modes');}};a.GifDetail=c;a.GifFavorite=d;a.GifModes=e;})(Giphy,_gaq);(function(a){var b={__checkboxChange:function(a){var b=$(a.currentTarget);this.model.save(b.attr('name'),b.is(':checked'));},__radioButtonChange:function(a,b,c){var d=$(b);if(d.data('name')!=='rating')return;this.model.save('rating',c);},__privacyToggle:function(a,b){var c=$(a.currentTarget);b?this.$privateGifIndicator.hide():this.$privateGifIndicator.show();this.model.save(c.data('name'),!b);},__editToggle:function(a,b){this.toggleEditMode(!b);},__confirmDeleteClick:function(b){b.preventDefault();var c=$(b.currentTarget).prop('disabled',true);this.model.save('delete-gif',true).fail(function(){c.prop('disabled',false);}).done(function(b){a.Events.trigger('radmodal:close');c.prop('disabled',false);if(b.result)window.location=b.result.data+'?message=gifdeleted&status=200';else window.showError('Unable to delete GIF. '+b.result.message);});},__saveMetadata:function(a){if(!a)return;var b=$(a);var c=b.find('.metadata-field');var d=b.find('.metadata-label .value');var e=c.find('input:text');if(e.length)this.model.save(e.attr('name'),e.val().trim()).done(function(){var a=e.val().trim();e.data('original-value',a);d.text(a);c.removeClass('open');});},initialize:function(b){b=b||{};this.$win=$(window);this.$body=$('body');this.$el=$(b.el||'#gif-info-container');this.model=a.GifEditModel;this.gifId=b.gifId||$('#gif').data('gif_id');this.editUrl=b.editUrl||$('#gif').data('editUrl');this.absoluteUrl=b.absoluteUrl||$('#gif').data('absoluteUrl');this.subviews={};this.model.initialize({gifId:this.gifId}).fetch().done($.proxy(this.render,this));},cacheSelectors:function(){this.$infoWrapper=this.$el.find('.gif-info-wrapper');this.$editWrapper=this.$el.find('.gif-edit-wrapper');this.$editToggle=this.$el.find('.edit-gif-toggle');this.$privateGifIndicator=this.$el.find('#private-gif-indicator');},render:function(b){if(!b||!this.$el.length)return;this.$el.html(b);this.cacheSelectors();a.Globals.refresh();this.subviews.editTags=a.GifEditTags.initialize({gifId:this.gifId,el:this.$el.find('#tags')});this.subviews.editMetadata=a.GifEditMetadata.initialize({onSave:$.proxy(this.__saveMetadata,this)});this.$el.on('toggle.gif-edit','.edit-gif-toggle',$.proxy(this.__editToggle,this));this.$el.on('change.gif-edit','.checkbox input:checkbox',$.proxy(this.__checkboxChange,this));this.$el.on('toggle.gif-edit','.privacy-toggle',$.proxy(this.__privacyToggle,this));this.$body.on('click.gif-edit','.rad-modal .delete-button',$.proxy(this.__confirmDeleteClick,this));a.Events.on('radiobutton:change',$.proxy(this.__radioButtonChange,this));if(window.location.pathname===this.editUrl)this.toggleEditMode(true);},remove:function(){this.$el.off('.gif-edit');this.$body.off('.gif-edit');for(key in this.subviews){var b=this.subviews[key];b.remove();}a.Events.off('radiobutton:change');},toggleEditMode:function(b){b=b||false;b?this.$infoWrapper.hide():this.$infoWrapper.show();b?this.$editWrapper.show():this.$editWrapper.hide();this.$editToggle.toggleClass('active',!b);if(window.history){var c=(b&&this.editUrl)?this.editUrl:this.absoluteUrl;window.history.replaceState({},document.title,c);}if(b)setTimeout($.proxy(function(){$('html, body').animate({scrollTop:this.$editWrapper.offset().top},200);},this),100);else setTimeout(function(){a.Events.trigger('gifedit:toggle');});}};var c={__editClick:function(a){a.preventDefault();var b=$(a.currentTarget);var c=b.closest('.metadata-section').find('.metadata-field');var d=c.hasClass('open');this.$fields.removeClass('open');this.$win.off('.gif-metadata');if(!d&&c.length){c.addClass('open');c.find('input:text').select();this.$win.on('keydown.gif-metadata',$.proxy(this.__windowKeydown,this));}else b.val(b.data('original-value'));},__clearClick:function(a){a.preventDefault();var b=$(a.currentTarget);var c=b.closest('.metadata-field').find('input:text');if(c.length)c.val('').focus();},__saveClick:function(a){a.preventDefault();var b=$(a.currentTarget);this.save(b.closest('.metadata-section'));},__inputKeydown:function(a){if(a.which===13){var b=$(a.currentTarget);this.save(b.closest('.metadata-section'));}},__windowKeydown:function(a){if(a.which===27){this.$fields.removeClass('open');this.$inputs.each(function(){$(this).val($(this).data('original-value'));});}},initialize:function(a){a=a||{};this.$win=$(window);this.$el=$(a.el||'.metadata');this.$sections=$();this.$field=$();this.$inputs=$();this.onSave=a.onSave||$.noop;this.render();return this;},render:function(){if(!this.$el.length)return;this.$sections=this.$el.find('.metadata-section');this.$fields=this.$el.find('.metadata-field');this.$inputs=this.$el.find('.metadata-field input:text');this.$inputs.each(function(){var a=$(this);a.data('original-value',a.val());});this.$el.on('click.gif-metadata','.edit-icon',$.proxy(this.__editClick,this));this.$el.on('click.gif-metadata','.clear-button',$.proxy(this.__clearClick,this));this.$el.on('click.gif-metadata','.save-button',$.proxy(this.__saveClick,this));this.$el.on('keydown.gif-metadata','.metadata-field input:text',$.proxy(this.__inputKeydown,this));},save:function(a){this.onSave.call(this,a);},remove:function(){this.$el.off('.gif-metadata');}};var d={initialize:function(a){a=a||{};this.gifId=a.gifId;return this;},fetch:function(){var a=$.Deferred();if(String(this.gifId).length)$.ajax({url:'/ajax/gif/'+this.gifId+'/detail',type:'GET',success:function(b){a.resolve(b);},error:function(){a.reject();}});else a.reject();return a.promise();},save:function(a,b){var c=$.Deferred();if(String(this.gifId).length)$.ajax({type:'POST',url:'/ajax/gif/update',data:{key:a,value:b,gif_id:this.gifId},success:function(a){if(a.result&&a.result.code!==200){window.showError(a.result.message||'Uh-oh. Something went wrong. Please try again.');c.reject();}else{window.showSuccess('GIF updated!');c.resolve(a);}return a;},error:function(){window.showError('Uh-oh. Something went wrong. Please try again.');c.reject();}});else c.reject();return c.promise();}};var e={__deleteClick:function(a){a.preventDefault();var b=$(a.currentTarget);var c=b.closest('.tag');c.addClass('deleted');setTimeout($.proxy(function(){this.submitTag(c.data('tag'),true);c.remove();},this),300);},__addClick:function(a){a.preventDefault();this.submitTag(this.$input.val());},__input:function(){this.$addButton.toggleClass('disabled',this.$input.val().trim().length<1);},__keydown:function(a){if(a.which===13)this.submitTag(this.$input.val());},__success:function(a,b){if(!b||!b.result||b.result.code!==200){this.__error();return;}this._reset();if(!a){var c=b.result.data;this._addNewTag(c.tag_name,c.tag_slug);this.$input.select();window.showSuccess('Tag added!');}else window.showSuccess('Tag deleted!');},__error:function(){this._reset();window.showError('Uh oh. Something went wrong. Please try again.');},_reset:function(){this.$addButton.addClass('disabled');this.$input.val('');},_addNewTag:function(a,b){var c=this.template.replace(/TAGNAME/g,a).replace(/TAGURL/g,b);var d=$(c);this.$el.append(d);setTimeout(function(){d.removeClass('new-tag');},500);},initialize:function(a){a=a||{};this.url=a.url||'/ajax/gif/update';this.gifId=a.gifId||$('#gif').data('gif_id');this.template=$(a.template||'#new-tag-template').html();this.$el=$(a.el||'#tags');this.render();return this;},render:function(){this.$input=this.$el.find('.add-tag-input');this.$addButton=this.$el.find('.add-tag-button');this._reset();this.$el.on('input.edit-tags','.add-tag-input',$.proxy(this.__input,this));this.$el.on('keydown.edit-tags','.add-tag-input',$.proxy(this.__keydown,this));this.$el.on('click.edit-tags','.add-tag-button',$.proxy(this.__addClick,this));this.$el.on('click.edit-tags','.delete-tag-button',$.proxy(this.__deleteClick,this));},submitTag:function(a,b){if(!a||!a.trim().length)return;b=b||false;if(!b)a=a.replace('#','');$.ajax({type:'POST',url:this.url,data:{'gif_id':this.gifId,'key':b?'delete-tag':'create-tag','value':a},success:$.proxy(this.__success,this,b),error:$.proxy(this.__error,this)});},remove:function(){this._reset();this.$el.off('.edit-tags');}};a.GifEdit=b;a.GifEditModel=d;a.GifEditMetadata=c;a.GifEditTags=e;})(Giphy);(function(a){var b={initialize:function(){this.subviews={};this.subviews.copyInputs=a.CopyInputs.initialize();this.subviews.toggleInputs=a.ToggleInputs.initialize();this.subviews.checkboxInputs=a.CheckboxInputs.initialize();this.subviews.radioButtons=a.RadioButtons.initialize();this.subviews.tooltips=a.Tooltips.initialize();this.subviews.radModal=a.RadModal.initialize();},refresh:function(){for(key in this.subviews){var a=this.subviews[key];a.remove();a.initialize();}}};var c={__click:function(a){var b=$(a.currentTarget);b.select();},__copy:function(a){window.showSuccess('Copied to clipboard!');},initialize:function(a){a=a||{};this.$inputs=$('input[data-copy="true"]');this.render();return this;},render:function(){if(!this.$inputs.length)return;this.$inputs.on('click.copy-input',$.proxy(this.__click,this));this.$inputs.on('copy.copy-input',$.proxy(this.__copy,this));},remove:function(){if(!this.$inputs.length)return;this.$inputs.off('.copy-input');}};var d={__click:function(b){b.preventDefault();var c=$(b.currentTarget);var d=c.data();var e=false;if(d.isAnimating)return;c.toggleClass('active');e=c.hasClass('active');c.data('is-animating',true);setTimeout(function(){c.data('is-animating',false);},this.animationDelay);c.trigger('toggle',e);a.Events.trigger('toggleinput:toggle',c,e);},initialize:function(a){a=a||{};this.$toggles=$('.settings-toggle');this.animationDelay=a.animationDelay||500;this.render();return this;},render:function(){if(!this.$toggles.length)return;this.$toggles.on('click.toggle-input',$.proxy(this.__click,this));},remove:function(){if(!this.$toggles.length)return;this.$toggles.off('.toggle-input');}};var e={__click:function(a){a.preventDefault();var b=$(a.currentTarget);var c=b.closest('.checkbox');var d=c.find('input:checkbox');c.toggleClass('checked');if(d.length)d.prop('checked',c.hasClass('checked')).trigger('change');},initialize:function(a){a=a||{};this.$checkboxes=$('.checkbox');this.render();return this;},render:function(){if(!this.$checkboxes.length)return;this.$checkboxes.each(function(){var a=$(this);var b=a.find('input:checkbox');if(b.length)a.toggleClass('checked',b.prop('checked'));});this.$checkboxes.on('click.checkbox-input','.checkbox-icon',$.proxy(this.__click,this));},remove:function(){if(!this.$checkboxes.length)return;this.$checkboxes.off('.checkbox-input');}};var f={__click:function(b){b.preventDefault();var c=$(b.currentTarget);var d=c.closest('.radio-options');var e=c.data('value');d.find('.selected').removeClass('selected');c.addClass('selected');d.trigger('change',e);a.Events.trigger('radiobutton:change',d,e);},initialize:function(a){a=a||{};this.$radioButtons=$('.radio-options');this.render();return this;},render:function(){if(!this.$radioButtons.length)return;this.$radioButtons.on('click.radio-buttons','.radio-option',$.proxy(this.__click,this));},remove:function(){if(!this.$radioButtons.length)return;this.$radioButtons.off('.radio-buttons');}};var g={__mouseover:function(a){var b=$(a.currentTarget);var c=b.outerWidth();var d=b.outerHeight();var e=b.offset();this.$tooltip.text(b.data('tooltip')).css({left:e.left+(c*0.5),top:e.top+d-this.$win.scrollTop()}).appendTo(this.$body);},__mouseout:function(){this.$tooltip.remove();},initialize:function(a){a=a||{};this.$win=$(window);this.$body=$('body');this.$elements=$('*[data-tooltip]');this.$tooltip=$('<div class="giphy-tooltip"></div>');this.render();return this;},render:function(){if(!this.$elements.length)return;this.$elements.on('mouseover.tooltip',$.proxy(this.__mouseover,this));this.$elements.on('mouseout.tooltip',$.proxy(this.__mouseout,this));},remove:function(){if(!this.$elements.length)return;this.$elements.off('.tooltip');}};var h={__keydown:function(a){if(a.which===27)this._reset();},__triggerClick:function(a){a.preventDefault();var b=$(a.currentTarget).data();if(b.content){var c=$(b.content);this.open({title:b.title,description:b.description,content:c.html()});}},__cancelClick:function(a){a.preventDefault();this._reset();},_reset:function(){this.$modal.remove();this.$dim.remove();this.$title.html('');this.$description.html('');this.$content.html('');this.$body.removeClass('no-scroll');this.$win.off('.rad-modal');},initialize:function(){this.$win=$(window);this.$body=$('body');this.$modal=$('<div class="rad-modal"></div>');this.$dim=$('<div class="rad-modal-dim"></div>');this.render();return this;},render:function(){this.$hand=$('<div class="rad-modal-hand"><div class="hand-inner"></div></div>').appendTo(this.$modal);this.$title=$('<span class="title"></span>').appendTo(this.$modal);this.$description=$('<span class="description"></span>').appendTo(this.$modal);this.$content=$('<div class="content"></div>').appendTo(this.$modal);this.$body.on('click.rad-modal','.rad-modal-trigger',$.proxy(this.__triggerClick,this));this.$body.on('click.rad-modal','.rad-modal-dim',$.proxy(this._reset,this));this.$body.on('click.rad-modal','.rad-modal .cancel-button',$.proxy(this.__cancelClick,this));a.Events.on('radmodal:close',$.proxy(this._reset,this));},open:function(a){a=a||{};this._reset();if(a.title)this.$title.text(a.title);if(a.description)this.$description.text(a.description);if(a.content)this.$content.html(a.content);this.$body.addClass('no-scroll').append(this.$modal).append(this.$dim);this.$win.on('keydown.rad-modal',$.proxy(this.__keydown,this));},close:function(){this._reset();},remove:function(){this._reset();this.$body.off('.rad-modal');this.$win.off('.rad-modal');a.Events.off('radmodal:close');}};a.Globals=b;a.CopyInputs=c;a.ToggleInputs=d;a.CheckboxInputs=e;a.RadioButtons=f;a.Tooltips=g;a.RadModal=h;})(Giphy);(function(){var a=Giphy.Homepage={init:function(){var a=$('#homepage');if(a.length){Giphy.Homepage.attachInfiniteScroll();Giphy.Homepage.attachHovers();Giphy.Homepage.playFeaturedViewport();Giphy.Homepage.attachNotice();$(document).on('scroll',function(){Giphy.Homepage.playFeaturedViewport();});}},attachInfiniteScroll:function(){$.extend($.infinitescroll.prototype,{beginAjax:function a(a){var b=this,c=a.path,d,e;if(typeof a.state.nextPage!='undefined')e=a.state.nextPage;else e=c[0];var f=$(a.contentSelector).is('table, tbody')?$('<tbody/>'):$('<div/>');f.load(e+' '+a.itemSelector,undefined,function g(c){next=$($(c).find(a.nextSelector));a.state.nextPage=next.attr("href");e=a.state.nextPage;b._loadcallback(f,c,e);});}});window.CURRENT_PAGE=1;$('.homepage').infinitescroll({nextSelector:"a#next-page-arrow",navSelector:"div#paging",itemSelector:".homepage-half",bufferPx:10,state:{currPage:window.CURRENT_PAGE},pathParse:function(a,b){var c=a.split('?')[0];var d=a.split('?')[1];var e=d?"?"+d+"&is=1":"?is=1";var f=['/page/'+b+e+''];return f;},behavior:"giphy",loading:{finishedMsg:"",img:"/static/img/loading_bar_page.gif",msgText:"",speed:'fast',finished:function(){$('#infscr-loading').remove();var a=$(this).data('infinitescroll');window.CURRENT_PAGE+=1;window.OFFSET_PAGE=window.CURRENT_PAGE-1;Giphy.Analytics.fireEvents('/page/'+window.CURRENT_PAGE);Giphy.Homepage.attachHovers();}}});},attachHovers:function(){var a=$('.hoverable');a.mouseenter(function(a){var b=$(this).find('img'),c=$(this).find('.loader'),d=b.attr('data-animated');$('.loader').hide();c.show();b.addClass('hovering');$("<img />").attr('src',d).load(function(){c.css('display','none');if(b.hasClass('hovering')){b.removeAttr('nopin');b.attr('src',d);}});});a.mouseleave(function(a){var b=$(this).find('img'),c=$(this).find('.loader'),d=b.attr('data-static');b.removeClass('hovering');b.attr('nopin','nopin');b.attr('src',d);c.hide();});},playFeaturedViewport:function(){var a=$('.homepage-featured');var b=$(window).scrollTop();var c=b+$(window).height();$.each(a,function(a,d){var e=$(d),f=e.find('img'),g=e.find('.loader'),h=f.attr('data-animated'),i=f.attr('data-static');if((((e.offset().top+e.height())<=c)&&((e.offset().top+e.height())>=b))){if(f.attr("src")!=f.attr("data-animated")){f.addClass('hovering');$("<img />").attr('src',h).load(function(){g.css('display','none');if(f.hasClass('hovering')){f.removeAttr('nopin');f.attr('src',h);}});}}else{f.removeClass('hovering');f.attr('nopin','nopin');f.attr('src',i);g.hide();}});},attachNotice:function(){if($("#notice-banner").length>0){var a="giphy-"+$("#notice-banner").data('name');if(!$.cookie(a)){setTimeout(function(){$("#notice-content").appendTo("#notice-banner");$("#notice-content").show();$("#notice-banner").slideDown();},3000);$("#notice-dismiss").on('click',function(b){b.preventDefault();Giphy.Homepage.dismissNotice(a);return false;});}}},dismissNotice:function(a){$.cookie(a,"1",{expires:365});if($("#notice-banner").length>0)$("#notice-banner").slideUp();}};})(window,Giphy);(function(){var a=Giphy.Images={preloadImages:function(){var a=["https://giphy.com/static/img/facebook_animated.gif","https://giphy.com/static/img/twitter_animated.gif","https://giphy.com/static/img/loading_bar.gif"];for(i=0;i<a.length;i++){var b=new Image();b.src=a[i];}},showOriginalSize:function(){if($("#gif").attr("data-padding-top")>0){$("#gif").css('height',$("#gif").attr("data-original-height"));$("#gif").css('width',$("#gif").attr("data-original-width"));$("#gif").css('padding-top',$("#gif").attr("data-padding-top")+'px');}return false;},sizeImages:function(){var a=$('.last-row').find('li');var b=$('.freeform').find('li.ungrouped');var c=$('li.ungrouped .upload-gif');b.removeClass("ungrouped");var d=$.merge(a,b);var e=d.find('img');if(c.length)if(!window.uploadButtonPlaced){e=$.merge(c,e);window.uploadButtonPlaced=true;}else c.closest('li').remove();if(e.length===0)return;var f=0;if($(".fb_container").length==0){var g=$('#content').width();var h=200;var i=$("#_giphy_tv").length>0&&(typeof _suppress_tv_resize=='undefined');}else{var g=700;var h=150;var h=200;var i=false;}if(typeof window.margin==='undefined'){var j=parseInt($(e[0]).closest('li').css("margin-right"),10);window.margin=j;}else var j=window.margin;var k=[];var l=0;var m=0;window.tvPlaced=window.tvPlaced||false;$.each(e,function(a){var b=e[a];var c=parseInt($(b).attr("data-width"),10);var d=parseInt($(b).attr("data-height"),10);if(d!=h)c=Math.floor(c*(h/d));k.push(parseInt(c,10));});while(f<e.length){var n=0;var o=0;var p=0;var q=0;var r=false;var s=(l<2&&i&&$(window).width()>480&&!window.tvPlaced)?g/2:g+j;while(p<s){if(f+n==k.length){p+=j;r=true;break;}var t=k[f+n]+j;p+=t;if(f+n>=e.length){r=true;break;}n++;}var u=$("<div class='hoverable'/>");if(i&&!tvPlaced&&l<2){$(u).css('float','left');$(u).css('width',s);$(u).css('clear','left');}var v=s/p;while(o<n){var w=k[f]*v;var x=h*v;var y=$(e[f]);if(r){w=parseInt($(y).attr('data-width'),10);x=parseInt($(y).attr('data-height'),10);}q+=w+j;y.width(w);y.height(x);var z=y.closest('li');u.append('<li style="width: '+w+'px;">'+z.html()+'</li>');z.remove();if(o==n-1){B=$(u).find("li:last");B.css('margin-right','0px');}o++;f++;}if(!r)if(q>s){var A=0;while(q>s){var B=$(u).find("li:nth-child("+(A+1)+")");var y=B.find('img, .upload-gif');$(y).width($(y).width()-1);$(B).width($(B).width()-1);q--;if(++A>=$(u).find("img").length)A=0;}}else if(q<s){var A=0;while(q<s){var B=$(u).find("li:nth-child("+(A+1)+")");var y=B.find('img, .upload-gif');$(y).width($(y).width()+1);$(B).width($(B).width()+1);q++;if(++A>=$(u).find("img").length)A=0;}}if(r===true)u.addClass('last-row');$('.gifs').append(u);if(i&&!window.tvPlaced&&l<2)m+=$(u).height();l++;$(document).trigger("images:done_sizing");}if(i&&!window.tvPlaced){var C=function(){if($("#asdf-container").length==0){setTimeout(C,100);return;}window.tvPlaced=true;$("#_giphy_tv").width(g/2);$("#_giphy_tv").height(m-5);__TV.sizeTo(g/2,m-5);__TV.resize();__TV.sizeTo(g/2,m-5);$("#_giphy_tv").css('margin-top','-35px');};C();}$('.bottom-tags a').show();return this;},sizeImagesToFrame:function(){var a=$('.framed-gif');if(a.length)$.each(a,function(a,b){var c=$(b),d=c.attr("data-original-height"),e=c.attr("data-original-width"),f=c.parents(".frame"),g=f.width(),h=f.height(),i=e/d,j=g/h,k,l,m,n;if(i>=j){m=(h/d)*e;n=h;l=-(m-g)/2;k=0;}else{m=g;n=(g/e)*d;l=0;k=-(n-h)/2;}c.css({"margin-top":k,"margin-left":l});c.attr({"height":n,"width":m});});},removePageNumbersForBackButton:function(){var a=$('.hoverable li');if(a.length)a.each(function(a,b){href=$(b).find(".a-gif");href.click(function(a){var b=window.location.href;var c=b.replace('http://','').split('/').length;if(b.indexOf("search")!=-1&&c==4){var d=b.replace(b.substr(b.lastIndexOf('/')+1),'');if(window.history.pushState)window.history.pushState("","",d);}});});},attachHovers:function(){var a=$(".hoverable li, .row-tag, .featured-item, .featured-user");if(a.length){a.off("mouseenter","**").mouseenter(function(a){var b=$(this).find(".hover-target").length?$(this).find(".hover-target"):$(this).find('img'),c=$(this).find('.loader'),d=b.attr('data-animated'),e=$(this).find('.promote-gif-hover');$('.loader').hide();c.css('display','block');b.addClass('hovering');$("<img />").attr('src',d).load(function(){c.css('display','none');if(b.hasClass('hovering')){b.removeAttr('nopin');b.attr('src',d);if(b.width()<150){e.find('h1').text('top').css('margin-right',10);e.find('.promote-gif-text').css('width','auto');}e.show();}});});a.off("mouseleave","**").mouseleave(function(a){var b=$(this).find(".hover-target").length?$(this).find(".hover-target"):$(this).find('img');b.removeClass('hovering');b.attr('nopin','nopin');b.attr('src',$(b).attr('data-still'));b.parent('.gif').parent().children('.loader').css('display','none');$(this).find('.promote-gif-hover').hide();});}return this;}};})(window,Giphy);(function(){var a=Giphy.Instagram={showModal:function(){var a=$("#instagram-share"),b=$('#instashare-share'),c=$('#instashare-send-button'),d=$("#instashare-loader"),e=$('#instashare-email-input');e.keypress(function(a){if(a.which==13)c.click();});$(".instashare-okbutton").click(function(){a.removeClass('hover');$("#instashare-modal").hide();});a.click(function(){if($('#instashare-modal').css('display')=='block'){$("#instashare-modal").hide();a.removeClass('hover');}else{$(".dialog").hide();$('.hover').removeClass('hover');$("#instashare-modal").show();a.addClass('hover');}b.show();c.show();d.hide();e.val('');});c.click(function(){c.hide();d.show();var b="/ajax/instashare/";$.ajax({type:"post",url:b,data:{"gif_id":$('#gif').attr("data-gif_id"),"to":$("#instashare-email-input").val()}}).always(function(b){if(b.result)if(b.result.code!=200){showError("UH OH. Something went wrong. Try again?");a.removeClass('hover');$("#instashare-modal").hide();}else{showSuccess("Success! Check your email in about 5 minutes. We sent you a GIF you can upload to Instagram.");a.removeClass('hover');$("#instashare-modal").hide();}else{showError("UH OH. Something went wrong. Try again?");a.removeClass('hover');$("#instashare-modal").hide();}});});}};})(window,Giphy);(function(){var a=Giphy.Login={facebook:function(){var a=Giphy.Utils.getParameterByName("next");if(a)window.LOGIN_NEXT=location.protocol+"//"+location.host+a;$(".facebook-login").click(function(){if(window.LOGIN_NEXT)document.location.href='/login/facebook/?next='+window.LOGIN_NEXT+"?status=200&message=login";else document.location.href='/login/facebook/';return false;});return this;},loginFocus:function(){var a=$("#login-form");if(a.length)$("#email").focus();}};})(window,Giphy);(function(){var a=Giphy.Nav={share:function(){$("input[type='text']").on("click",function(){$(this).select();});},attachFooter:function(){if(($('#homepage').length>0)||($(".freeform").length>0)){var a=$("#footer");a.css('position','fixed');a.css('bottom','0px');a.css('opacity','0');a.css('z-index','10000');$(document).mousemove(function(b){var c=$(window);var d=b.pageY;var e=c.height()+c.scrollTop()-d-200;if(e<=100)a.css('opacity','1');else a.css('opacity','0');});}}};})(window,Giphy);(function(){var a=Giphy.Newsletter={attachNewsletter:function(){if($("#newsletter-placeholder").length>0)if(!$.cookie("dismiss-newsletter")){setTimeout(function(){$("#newsletter-content").appendTo("#newsletter-placeholder");$("#newsletter-content").show();$("#newsletter-placeholder").slideDown();},3000);$("#newsletter-dismiss").on('click',function(a){a.preventDefault();Giphy.Newsletter.dismissNewsletter();return false;});}$("#newsletter-form").on('submit',function(a){a.preventDefault();var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(!b.test($("#newsletter-email").val())){showError("Please enter a valid email address.");return;}$("#newsletter-content").removeClass('inactive');$("#newsletter-content").addClass('active');$.ajax({type:'post',url:'/ajax/newsletter',data:{'email':$("#newsletter-email").val(),'action':$(this).attr('data-action')},dataType:'json',error:function(a){$("#newsletter-content").removeClass('active');$("#newsletter-content").addClass('inactive');showError("An error occurred.");},success:function(a){if(a.result.error){showError(a.result.error);$("#newsletter-content").removeClass('active');$("#newsletter-content").addClass('inactive');}else{if($("#newsletter-content").length>0)$("#newsletter-form").animate({"margin-top":"200"},300,function(){});$("#newsletter-content").removeClass('active');$("#newsletter-content").addClass('success');if(document.location.pathname!='/'){Giphy.Newsletter.dismissNewsletter();showSuccess(a.result.response,'/',1500);}else setTimeout(function(){Giphy.Newsletter.dismissNewsletter();},2000);}}});});},dismissNewsletter:function(){$.cookie("dismiss-newsletter","1",{expires:365});if($("#newsletter-placeholder").length>0)$("#newsletter-placeholder").slideUp();}};})(window,Giphy);(function(){var a=Giphy.Overlays={getShareHtml:function(){return [$("<a>",{"id":"fb-share","class":"facebook facebook-blue social-share","title":"Share on Facebook","target":"_blank","href":"#","click":function(){window.open("http://www.facebook.com/sharer/sharer.php?u="+document.URL,"1361370515039","width=650,height=280,toolbar=0,menubar=0,location=0,status=0,scrollbars=0,resizable=1,left=0,top=0");return false;}}),$("<a>",{"id":"twitter-share","class":"twitter twitter-blue social-share","title":"Share on Twitter","target":"_blank","href":"#","click":function(){window.open("http://twitter.com/share?url="+document.URL+"?tc=1&text="+window.socialShareTitle+"&via=giphy","1361370074860","width=500,height=252,toolbar=0,menubar=0,location=0,status=1,scrollbars=0,resizable=1,left=0,top=0");return false;}})];},getGifViewHtml:function(){var a=this;var b=[$("<a>",{"id":"gif-tile-link","class":"gif-tile-link sprite _023_tile","title":"Tile View","href":a.createOverlayUrl('tile')}),$("<a>",{"id":"gif-fullscreen-link","class":"gif-fullscreen-link sprite _004_fullscreen","title":"Fullscreen View","href":a.createOverlayUrl('fullscreen')})];if($("#gif-mp4").length>0)b.push($("<a>",{"id":"gif-version-link","class":"gif-version-link","title":"GIF View","href":a.createOverlayUrl('gif')}).text('GIF'));return b;},createOverlayUrl:function(a){var b=document.URL.split('?');var c=b[0].replace("home","").replace("edit","").replace("tile","").replace("fullscreen","").replace(/\/$/,'');if(a=="gif")return c;if(b[1]!=undefined)return c+"/"+a+"?"+b[1];else return c+"/"+a;},addShareLinksToPostIframes:function(){var a=this,b=$("#post-detail");if(b.length)$(document).ready(function(){$("#post-content iframe").each(function(){var b=$(this);b.wrap("<div class='iframe-wrap' style='position:relative;'></div>");b.after($("<div>",{"class":"iframe-overlay-share grid_8","html":a.getShareHtml()}));b.parent(".iframe-wrap").mouseover(function(a){$(this).find(".iframe-overlay-share").fadeIn();});b.parent(".iframe-wrap").mouseleave(function(a){$(this).find(".iframe-overlay-share").fadeOut();});});});},addOverlayToGifDetail:function(){var a=this,b=$("img#gif, video#gif-mp4"),c=$("#gif-wrap"),d=$("#fullscreen-overlay"),e=$("#gif-wrap .gif-hover");if(c.length){$(document).ready(function(){e.append($("<div>",{"class":"gif-overlay-views","id":"gif-overlay-views","html":a.getGifViewHtml()}));});c.bind({mouseenter:function(a){$("#gif-overlay-share, #gif-overlay-views").fadeIn();},mouseleave:function(a){$("#gif-overlay-share, #gif-overlay-views").fadeOut();}});}if(d.length)d.click(function(){window.location=document.URL.replace("tile","").replace("fullscreen","").replace(/\/$/,'');});},sizeFSOverlay:function(){var a=$("#fullscreen-overlay");if(a.length){var b=function(){var a=$("#gif,#gif-mp4"),b=$("#fullscreen-overlay"),c=a.data("original-height"),d=a.data("original-width"),e=$(window).width(),f=$(window).height(),g=d/c,h=e/f,i,j,k,l;if(g>=h){k=(f/c)*d;l=f;j=-(k-e)/2;i=0;}else{k=e;l=(e/d)*c;j=0;i=-(l-f)/2;}b.css({"height":l,"width":k,"margin-top":i,"margin-left":j});$('body').css({"overflow":"hidden","margin":0});};b();$(window).resize(function(){b();});}}};})(window,Giphy);(function(){var a=Giphy.Search={initMini:function(){if(!$("#mini-search-form").length)return;var a=$("#searchbar"),b=$("#search-box"),c=$("#search-button");b.blur();b.click(function(){var a=$('.search-bar-form button').find('img');if(a.hasClass('color'))return false;else{a.attr('src',a.attr('data-focus'));a.addClass('color');}});$(document).mouseup(function(b){var c=$('.search-bar-form button').find('img');if(!a.is(b.target)&&a.has(b.target).length===0){c.attr('src',c.attr('data-blur'));c.removeClass('color');}});b.keydown(function(a){var b=$('.searchbar button').find('img');if(!b.hasClass('color')){b.attr('src',b.attr('data-focus'));b.addClass('color');}});$("#mini-search-form").on('submit',function(a){var b=$('.search-bar-form button').find('img');if(b.attr('src')!=b.attr('data-submit')){a.preventDefault();a.stopImmediatePropagation();b.attr('src',b.attr('data-submit'));searchDelay=setTimeout(function c(){$("#mini-search-form").submit();},500);}});},init:function(){a.hasBeenEntered=false;a.hasKeyDown=false;var b=-1;var c=$("#searchbar"),d=$("#search-box"),e=$("#search-button");if(!(d.length>0))return;$("#placeholder").click(function(a){d.focus();});d.hover(function(){e.addClass("active");},function(){if(!$(this).is(":focus")&&$('.search-result').length==1)e.removeClass("active");});d.click(function(){var a=$('.searchbar button').find('img');if(a.hasClass('color'))return false;else{a.attr('src',a.attr('data-focus'));a.addClass('color');}});$(document).mouseup(function(a){var b=$('.searchbar button').find('img');if(!c.is(a.target)&&c.has(a.target).length===0){b.attr('src',b.attr('data-blur'));b.removeClass('color');}});d.focus(function(){$(".autocomplete").text("");e.addClass("active");});d.blur(function(){$(document).trigger("search:clear");});e.click(function(a){a.preventDefault();if(d.val().length>0)$(document).trigger("search:enter");});d.keydown(function(b){var c=$('.searchbar button').find('img');if(!c.hasClass('color')){c.attr('src',c.attr('data-focus'));c.addClass('color');}a.hasKeyDown=true;var d=b.which;if(d==38||d==40||d==9)b.preventDefault();else $("#placeholder").hide();});d.keyup(function(b){if(a.hasKeyDown===true){if(!a.hasBeenEntered){a.hasBeenEntered=true;_gaq.push(['_trackEvent','Search','QueryEntered']);}var c=b.which;var d=$("#search-box");var e=d.val();if(!e)$("#placeholder").show();if(c==37)return;if(c==38){$(document).trigger("search:up",b);b.preventDefault();return;}if(c==39){var f=$('.autocomplete').text();if(f&&f!=e)$(document).trigger("search:tab",f);b.preventDefault();return;}if(c==40){$(document).trigger("search:down",b);b.preventDefault();return;}if(c==9){var f=$('.autocomplete').text();if(f&&f!=e)$(document).trigger("search:tab",f);b.preventDefault();return;}if(c==13){b.preventDefault();a.enterPressed=true;$(document).trigger("search:enter",b);return;}var g=this;encoded=encodeURIComponent(e);if(typeof encoded==='undefined'||!encoded)return;$(document).trigger("search:execute");}});$(document).bind('search:execute',function(b){b.preventDefault();b.stopPropagation();var c=$("#search-box").val();var d=function(){$.get("/api/v1/tags/search/?q="+c,function(b){b.q=c;b.encoded=encoded;b.dont_display=false;if(a.enterPressed){a.enterPressed=false;b.dont_display=true;}$(document).trigger("search:success",b);}).fail(function(){$(document).trigger("search:error");});};if(Giphy.Timer!==undefined)Giphy.Timer.cancel();Giphy.Timer=new Giphy.Utils.timeout();Giphy.Timer.init(d,300,null);});$(document).bind('search:success',function(a,b){if(b.q!=$("#search-box").val())return;$(document).trigger("search:clear");for(var c=0;c<b.objects.length;c++){var d=$(".search-results").find('.search-result').first().clone();$(d).find('.word').text(b.objects[c].name);$(d).find('.word').attr("name-encoded",b.objects[c].name_encoded);d.mousedown(function(){if($(".fb_container").length==0)document.location.href="http://"+window.ASSET_DOMAIN+"/search/"+$(this).find(".word").attr("name-encoded");else{$("#search-box").val($(this).find(".word").attr("name-encoded"));$("#placeholder").hide();Giphy.Facebook.search($(this).find(".word").attr("name-encoded"));}});d.hover(function(){$(".hover").removeClass("hover");$(this).addClass("hover");},function(){$(this).removeClass("hover");});$(".search-results").append(d);$(".search-results").show();$(d).show();}if(b.dont_display)$(document).trigger("search:dont_display");});$(document).bind("search:clear",function(a){$(".autocomplete").text("");$('.search-result:visible').each(function(){$(this).remove();});b=-1;$('.search-results').hide();});$(document).bind("search:reset",function(a){$(document).trigger("search:clear");$('#search-box').val("");$("#placeholder").show();$('#search-box').blur();});$(document).bind("search:down",function(a){$('.search-result').removeClass('hover');b++;var c=$('.search-result:visible').length;if(b>=c)b=c-1;var d=$('.search-result:visible').eq(b);d.addClass("hover");$(document).trigger("search:selected",$(d).find('.word').text());});$(document).bind("search:up",function(a){$('.search-result').removeClass('hover');b--;if(b<0){$(".autocomplete").text("");$('#search_box').focus();b=-1;}else{var c=$('.search-result:visible').eq(b);c.addClass("hover");$(document).trigger("search:selected",$(c).find('.word').text());}});$(document).bind("search:enter",function(b){var c;b.preventDefault();b.stopImmediatePropagation();var d=$('.search-bar-form button').find('img');d.attr('src',d.attr('data-submit'));var e=$("#search-box").val();var f=$(".search-result.hover");var g=f.find(".word").text();var h=f.find(".word").attr("name-encoded");c=setTimeout(function i(){if(g)if($(".fb_container").length==0)document.location.href="http://"+window.ASSET_DOMAIN+"/search/"+h;else{Giphy.Facebook.search(h);$("#search-box").blur();a.hasKeyDown=false;$(document).trigger("search:clear");}else if(e.length>0)if($(".fb_container").length==0){var b=$("#searchbarform").length?$("#searchbarform"):$("#mini-searchbar-form");b.submit();}else{Giphy.Facebook.search(e);$("#search-box").blur();a.hasKeyDown=false;$(document).trigger("search:clear");}},500);return;});$(document).bind("search:selected",function(a,b){var c=$('#search-box');var d=$('.autocomplete');var e=c.val();var f="<span>";if(!b||e.trim().toLowerCase()==b)d.text('');else d.html(b);});$(document).bind("search:tab",function(a,b){$("#search-box").val(b);$(document).trigger("search:execute");});var f=navigator.userAgent.toLowerCase();if(!f.indexOf("android")>-1)d.focus();if($("#reaction-gifs").length>0)$("#reaction-gifs").mouseover(function(){$("#search-box").blur();});if($('.gifs').length)$('.gifs .gif img').each(function(){var a=$(this).attr('data-animated');if(a)$('<img/>')[0].src=a;});}};})(window,Giphy);(function(){var a=Giphy.SearchResults={attachInfiniteScroll:function(a){$('ul.freeform').infinitescroll({nextSelector:"a#next-page-arrow",navSelector:"div#paging",itemSelector:".freeform li.ungrouped",bufferPx:10,state:{currPage:window.CURRENT_PAGE},behavior:"giphy",loading:{finished:function(){$('#infscr-loading').remove();var a=$(this).data('infinitescroll');Giphy.Images.sizeImages();Giphy.Images.attachHovers();if(window.ADD_EDIT_JS===true)Giphy.UserEdit.addEditGifLinks();window.CURRENT_PAGE=a.options.state.currPage;window.OFFSET_PAGE=window.CURRENT_PAGE-1;current_page=a.options.path[0]+a.options.state.currPage;if($(".fb_container").length==0)Giphy.Analytics.fireEvents(current_page);else Giphy.Analytics.fireEvents(current_page,true);},finishedMsg:"",img:"/static/img/loading_bar_page.gif",msgText:"",speed:'fast'},pathParse:function(a,b){var c=a.split('/'),d=a.split('?')[1],e=$(".gif").last().parent().attr('href');appendParams=d?"?"+d+"&is=1":"?is=1",base=c[1],term=c[c.indexOf(base)+1];try{var f=parseInt(c[c.indexOf('search')+2],10);}catch(g){var f=1;}if(base=='search')return ['/'+base+'/'+term+'/',appendParams];else if(base=='channel')return ['/'+base+'/'+term+'/',appendParams];else return ['/'+base+'/',appendParams];}});if(a!==undefined)a();return this;}};})(window,Giphy);(function(){var a=Giphy.Sharing={shortURLs:function(){ZeroClipboard.config({swfPath:"/static/js/zeroclipboard.swf"});var a=new ZeroClipboard($(".short-link"));a.on('copy',function(a){a.clipboardData.setData("text/plain",$(".short-link").attr("data-url"));showSuccess("Short URL copied to clipboard!");});},attachShareTools:function(){ZeroClipboard.config({swfPath:"/static/js/zeroclipboard.swf"});var a=new ZeroClipboard($("#share-giphy-link-icon"));a.on('copy',function(a){a.clipboardData.setData("text/plain",$("#share-giphy-link").val());showSuccess("Giphy link copied to clipboard!");});var b=new ZeroClipboard($("#share-gif-link-icon"));b.on('copy',function(a){a.clipboardData.setData("text/plain",$("#share-gif-link").val());showSuccess("GIF link copied to clipboard!");});var c=new ZeroClipboard($("#share-html5-link-icon"));c.on('copy',function(a){a.clipboardData.setData("text/plain",$("#share-smart-link").val());showSuccess("HTML5 link copied to clipboard!");});var d=new ZeroClipboard($("#iframe-embed-code-icon"));d.on('copy',function(a){a.clipboardData.setData("text/plain",$("#iframe-embed-code").val());showSuccess("IFrame embed code copied to clipboard!");});var e=new ZeroClipboard($("#optimized-embed-code-icon"));e.on('copy',function(a){a.clipboardData.setData("text/plain",$("#optimized-embed-code").val());showSuccess("JS embed code copied to clipboard!");});var f=new ZeroClipboard($("#smart-embed-code-icon"));f.on('copy',function(a){a.clipboardData.setData("text/plain",$("#smart-embed-code").val());showSuccess("HTML5 embed code copied to clipboard!");});$("#modal-container").find("input[type='text']").click(function(){$(this).select();});$(document).bind("share-tools:open",function(){if($("#modal-container").css('display')=='none')$("#modal-container").show();});$(document).bind("close-all-modals",function(){if($("#modal-container").css('display')=='block')$("#modal-container").hide();});$(document).bind("share-tools:close",function(){if($("#modal-container").css('display')=='block')$("#modal-container").hide();});$(document).bind("share-tools:close-children",function(){$(".modal-child").hide();$('.hover').removeClass("hover");});$(".action").click(function(){if($(this).hasClass("hover")){$(document).trigger("share-tools:close");$(this).removeClass("hover");}else{$(document).trigger("share-tools:close-children");$(document).trigger("share-tools:open");$(this).addClass('hover');}return false;});$(".playchoice").on('click',function(){if($(this).attr('id')=='autoplay'&&!$(this).hasClass('active-playchoice')){$("#hoverplay").removeClass("active-playchoice");$("#hoverplay").addClass("inactive-playchoice");$(this).removeClass("inactive-playchoice");$(this).addClass("active-playchoice");$("#iframe-embed-code").val($("#iframe-embed-code").val().replace("?playOnHover=true",""));$("#optimized-embed-code").val($("#optimized-embed-code").val().replace("var _giphy_play_on_hover = true;",""));}else if($(this).attr('id')=='hoverplay'&&!$(this).hasClass('active-playchoice')){$("#autoplay").addClass("inactive-playchoice");$("#autoplay").removeClass("active-playchoice");$(this).addClass("active-playchoice");$(this).removeClass("inactive-playchoice");$("#iframe-embed-code").val($("#iframe-embed-code").val().replace(/embed\/([a-zA-Z0-9-_]*)/,"embed\/$1?playOnHover=true"));$("#optimized-embed-code").val($("#optimized-embed-code").val().replace("var _giphy","var _giphy_play_on_hover = true; var _giphy"));}});$("#shorten-url").click(function(){$(".shortener-options").show();});$("#embed-share").click(function(){$(".embed-options").show();});$("#share-link").click(function(){$(".share-options").show();});$("#redirect-to").on('click',function(){$(this).select();});$("#redirect-to").keyup(function(a){var b=a.which;if(b==13){a.preventDefault();$("#shorten-create-submit").click();return;}});var g=$("#shorten-create-submit");g.click(function(a){a.preventDefault();var b=this;$(b).prop('disabled',true);$(b).attr('value','ONE SEC...');$.ajax({type:"post",url:"//"+window.ASSET_DOMAIN+"/ajax/shorturl/create/",data:{'gif_id':$("#gif").attr('data-id'),'redirect_to':$('#redirect-to').val()}}).success(function(a){if(a.result.code!=200)return;else{$(b).prop('disabled',false);$(b).attr('value','Shorten');$("#redirect-to").val(a.result.short_url);var c=new ZeroClipboard(g);g.val("Copy");g.css('background-color','#2afd9c');c.on('copy',function(b){b.clipboardData.setData("text/plain",a.result.short_url);showSuccess("Short URL copied to clipboard!");});}}).error(function(){$(b).prop('disabled',false);$(b).attr('value','Shorten');showError("An error has occurred.");});});var h=$('#tumblr-share').not('.post');if(h.length)h.click(function(a){a.preventDefault();if(window.PHOTOBOOTH)window.open("http://www.tumblr.com/share/photo?source="+encodeURIComponent($('#gif').attr('data-image_original_url').replace('giphy.gif','500w.gif'))+"&caption="+encodeURIComponent(document.title)+"&clickthru="+encodeURIComponent($('#gif').attr('data-bitly_gif_url')),'1361370515040','width=620,height=500,toolbar=0,menubar=0,location=0,status=0,scrollbars=0,resizable=1,left=0,top=0');else window.open("http://www.tumblr.com/share/photo?source="+encodeURIComponent($('#gif').attr('data-tumblr_share_url'))+"&caption="+encodeURIComponent(document.title)+"&clickthru="+encodeURIComponent($('#gif').attr('data-bitly_gif_url')),'1361370515040','width=620,height=500,toolbar=0,menubar=0,location=0,status=0,scrollbars=0,resizable=1,left=0,top=0');});},attachSharingAnalytics:function(){var a=$('#embed-share');if(a.length)a.click(function(a){$.ajax({type:"post",beforeSend:function(a){a.setRequestHeader("Authorization","ApiKey giphy-website:e0771ed7b244ec9c942bea646ad08e6bf514f51a");},url:"/api/v1/analytics/",data:JSON.stringify({"gif_id":$('#gif').attr("data-gif_id"),"analytic_type":"embed_share"}),contentType:"application/json",dataType:"application/json"});});var b=$('#tumblr-share');if(b.length)b.click(function(a){a.preventDefault();$.ajax({type:"post",beforeSend:function(a){a.setRequestHeader("Authorization","ApiKey giphy-website:e0771ed7b244ec9c942bea646ad08e6bf514f51a");},url:"/api/v1/analytics/",data:JSON.stringify({"gif_id":$('#gif').attr("data-gif_id"),"analytic_type":"tumblr_share"}),contentType:"application/json",dataType:"application/json"});});var c=$('#fb-share');if(c.length)c.click(function(){$.ajax({type:"post",beforeSend:function(a){a.setRequestHeader("Authorization","ApiKey giphy-website:e0771ed7b244ec9c942bea646ad08e6bf514f51a");},url:"/api/v1/analytics/",data:JSON.stringify({"gif_id":$('#gif').attr("data-gif_id"),"analytic_type":"facebook_share"}),contentType:"application/json",dataType:"application/json"});});var d=$('#googleplus-share');if(d.length)d.click(function(){$.ajax({type:"post",beforeSend:function(a){a.setRequestHeader("Authorization","ApiKey giphy-website:e0771ed7b244ec9c942bea646ad08e6bf514f51a");},url:"/api/v1/analytics/",data:JSON.stringify({"gif_id":$('#gif').attr("data-gif_id"),"analytic_type":"googleplus_share"}),contentType:"application/json",dataType:"application/json"});});var e=$('#pinterest-share');if(e.length)e.click(function(){$.ajax({type:"post",beforeSend:function(a){a.setRequestHeader("Authorization","ApiKey giphy-website:e0771ed7b244ec9c942bea646ad08e6bf514f51a");},url:"/api/v1/analytics/",data:JSON.stringify({"gif_id":$('#gif').attr("data-gif_id"),"analytic_type":"pinterest_share"}),contentType:"application/json",dataType:"application/json"});});var f=$('#instagram-share');if(f.length)f.click(function(){$.ajax({type:"post",beforeSend:function(a){a.setRequestHeader("Authorization","ApiKey giphy-website:e0771ed7b244ec9c942bea646ad08e6bf514f51a");},url:"/api/v1/analytics/",data:JSON.stringify({"gif_id":$('#gif').attr("data-gif_id"),"analytic_type":"instagram_share"}),contentType:"application/json",dataType:"application/json"});});var g=$('#twitter-share');if(g.length)g.click(function(){$.ajax({type:"post",beforeSend:function(a){a.setRequestHeader("Authorization","ApiKey giphy-website:e0771ed7b244ec9c942bea646ad08e6bf514f51a");},url:"/api/v1/analytics/",data:JSON.stringify({"gif_id":$('#gif').attr("data-gif_id"),"analytic_type":"twitter_share"}),contentType:"application/json",dataType:"application/json"});});}};})(window,Giphy);(function(){var a=Giphy.Upload={initPUpload:function(){window.LOGIN_NEXT=location.pathname;var a=this;window.uploader=new plupload.Uploader({browse_button:"dropzone",url:$("#upload-gif-form").attr("action"),runtimes:'html5,flash,html4',mime_types:[{title:"Gifs",extensions:"gif"},{title:"Videos",extensions:"mp4,mov,m4v,mpg"}],dragdrop:true,drop_element:"user-content",flash_swf_url:'http://rawgithub.com/moxiecode/moxie/master/bin/flash/Moxie.cdn.swf'});window.uploader.bind("FilesAdded",function(b,c){var d=1;for(i=0;i<window.uploader.files.length;i++)if(i>=d){b.splice(i);window.showError("Only one gif at a time please. ;)");}else{$("#gif-url").hide();$('#optional-fields').slideDown();a.showUploadPreview(c[i]);}});Giphy.Events.on('toggleinput:toggle',function(a,b,c){var d=$('#is-hidden');d.val(c?0:1);});$("#upload-gif-button").on("click",function(b){b.preventDefault();var c={"session_key":$('#session-key').val(),"api_key":$('#api-key').val(),"tags":$('#tags').val(),"source_post_url":$('#source-post-url').val(),"source_image_url":$('#gif-url').val(),"username":$('#username').val(),"is_hidden":$('#is-hidden').val()};window.uploader.setOption("multipart_params",c);if(window.uploader.files.length===0){urlValue=$('#gif-url').val();if(urlValue.length>1){var d=new RegExp('(http|https)://[\\w-]+(\\.[\\w-]+)+([\\w-.,@?^=%&:/~+#-]*[\\w@?^=%&;/~+#-])?');if(d.test(urlValue)){$("#upload-gif-button").hide();$("#kr-loading").show();a.handleURLSubmit();}else{window.showError("Please Enter A Valid URL");return;}}else{window.showError("Please Select a GIF");return;}}else{$("#upload-gif-button").hide();$("#upload-progressbar").show();window.uploader.start();}});window.uploader.bind("UploadProgress",function(a,b){progressBar=$("#upload-progressbar-fill");progressText=$("#upload-progressbar-text");progressBar.css("width",b.percent+"%");progressText.html(b.percent+"%");if(b.percent>=98)progressText.text("Upload complete! Processing Gif...");});window.uploader.bind("FileUploaded",function(b,c,d){a.handleApiResponse(d.response);});window.uploader.bind("UploadComplete",function(a,b){$("#upload-progressbar-fill").css("width","100%");});window.uploader.bind("Error",function(a,b){Giphy.Upload.handleError();window.showError("Uh-oh. Something went wrong. Please try again: "+b.message);});window.uploader.init();a.optionalsListener();},optionalsListener:function(){var a=$('#optional-fields'),b=$('#gif-url');b.on('input',function(){if($('#gif-url').val())a.slideDown();else a.slideUp();});},showUploadPreview:function(a){var b=a.getNative(),c=new FileReader(),d=["image/gif"],e=["video/x-m4v","video/mpg","video/m4v","video/mov","video/mp4","video/quicktime"],f=$.inArray(a.type,d),g=$.inArray(a.type,e),h=Giphy.Utils.canPlayMP4();c.onload=function(b){var c=$(".preview-wrapper");if(f>-1){var d=new Image();d.src=b.target.result;var e=225,i=e/d.height,j=d.width*i,k=d.height*i,l=$("<img />",{"src":d.src,"height":k,"width":j,"class":"upload-preview"});$(".dropzone-text").hide();$(".upload-icon").hide();c.append(l);c.show();}else if(g>-1){$(".upload-icon").hide();if(h===true){$(".dropzone-text").hide();c.html('<video width="400" height="225" autoplay loop>'+'<source src="'+b.target.result+'" type="video/mp4"></source>'+'</video>');c.show();}else $(".dropzone-text").text(a.name);}else{$('#optional-fields').slideUp();$("#gif-url").show();window.uploader.removeFile(a);window.showError("Uh-oh. We don't support that file type.");}};c.readAsDataURL(b);},handleURLSubmit:function(){var a=this,b=new FormData($("#upload-gif-form")[0]);$.ajax({beforeSend:function(a){a.setRequestHeader("");},url:$("#upload-gif-form").attr("action"),type:"POST",cache:false,contentType:false,timeout:720000,processData:false,data:b}).done(function(b,c,d){a.handleApiResponse(b);}).fail(function(a,b,c){var d=a.statusCode();Giphy.Upload.handleError();window.showError("Uh-oh. Something went wrong. Please try again: "+b);return;});},handleError:function(){window.uploader.splice();window.uploader.refresh();var a=$("#upload-progressbar");a.hide();a.empty();a.css("width","0%");$("#upload-progressbar-text").html("0%");$("#kr-loading").hide();$("#gif-url").show();$(".dropzone-text").text("+GIF or VIDEO FILE");$(".dropzone-text").show();$("#upload-gif-button").show();$("#optional-fields").slideUp();$(".preview-wrapper").empty().hide();},handleApiResponse:function(a){if(typeof a=="undefined"){Giphy.Upload.handleError();window.showError("Uh-oh. Something went wrong. Please try again.");return;}if(typeof a=="string")a=$.parseJSON(a);var b=a.meta.status;if(b==200){if(a.data==undefined||a.data.id==undefined){Giphy.Upload.handleError();window.showError("Uh-oh. Something went wrong. Please try again.");return;}if(window.isGifys){$('#upload-gif-form').hide();$('#gifys-submission-complete').show();}else if(window.IS_PARTNER||window.IS_ARTIST||!window.LOGGED_IN)window.location="/gifs/"+a.data.id+"/?message=uploaded";else window.location="/gifs/"+a.data.id+"?status=200&message=uploaded";}else if(b==400){Giphy.Upload.handleError();window.showError(a.meta.msg);}else if(b==401)window.location=window.location+"?status=401";else if(b==409)if(window.IS_PARTNER||window.IS_ARTIST||!window.LOGGED_IN)window.location="/gifs/"+a.data.id+"/?message=uploaded";else{window.location="/gifs/"+a.data.id+"?status=409&message=uploaded";window.location="/favorites?status=409";}else if(b==480)window.location="/480";else if(b>=500){Giphy.Upload.handleError();window.showError("Uh-oh. Something went wrong. Please try again.");}else{Giphy.Upload.handleError();window.showError("Error:"+a.meta.msg);}}};})(window,Giphy);(function(a){var b={__aboutButtonClick:function(a){a.preventDefault();this.$aboutContainer.toggleClass('show-info');},__aboutGlassClick:function(a){a.preventDefault();this.$aboutContainer.removeClass('show-info');},initialize:function(a){a=a||{};this.$el=$(a.el||'#user-channel');this.render();},render:function(){if(!this.$el.length)return;this._cacheSelectors();this._bindEvents();this.determineBioLayout();},determineBioLayout:function(){if(!this.$aboutBio.length||!this.$aboutInfo.length)return;var a=0;var b=140;this.$aboutInfo.css('display','block');a=this.$aboutBio.height();this.$aboutInfo.css('display','');if(a>b)this.$aboutInfo.addClass('wide-layout');},_cacheSelectors:function(){this.$aboutContainer=this.$el.find('.about-container');this.$aboutBtn=this.$el.find('.about-button');this.$aboutGlass=this.$el.find('.about-glass');this.$aboutInfo=this.$el.find('.about-info');this.$aboutBio=this.$el.find('.about-bio');},_bindEvents:function(){this.$aboutBtn.on('click',$.proxy(this.__aboutButtonClick,this));this.$aboutGlass.on('click',$.proxy(this.__aboutGlassClick,this));}};a.UserChannel=b;})(Giphy);(function(){var a=Giphy.UserEdit={errorMessages:{'password':'Must be at least 6 characters.','email':'Please enter a valid email address.','url':'Please enter a valid url.','required':'This field can\'t be left blank.'},_addErrorToInput:function(a,b){if(!a)return;var c=$(a);_.defer(function(){$('html, body').stop(true,true).animate({scrollTop:c.offset().top-50});});if(c.hasClass('error'))return;var d=c.attr('type');var e=c.attr('required')||false;var f=c.get(0).validationMessage;if(e&&!c.val())f=this.errorMessages.required;else if(this.errorMessages[d])f=this.errorMessages[d];Giphy.Utils.showInputMessage(c,b||f,true);},_ajaxSubmitForm:function(a,b){if(!a)return;var c=$.Deferred();var d=$(a);var e=d.find(':input:visible');if(!d.get(0).checkValidity()){e.each($.proxy(function(a,b){if(!b.validity.valid)this._addErrorToInput(b);},this));c.reject();}else{var f=new FormData(d.get(0));$.ajax({url:d.attr('action'),type:'POST',data:f,processData:false,contentType:false,success:function(a){window.showSuccess('Settings updated!');if(a.result&&a.result.channel_url)$('.user-url').attr('href',a.result.channel_url);c.resolve(a);},error:$.proxy(function(a){var b=a.responseJSON.result;window.showError('Uh-oh. Something went wrong. Please try again.');c.reject(b);},this)});}return c.promise();},_bindSaveButtonEvents:function(a){if(!a)return;var b=$(a).attr('disabled',true);var c=b.closest('form');var d=c.find('.settings-field');var e=c.find(':input');var f=b.text();var g="Saving";var h="Success";var i=c.serialize();e.on('input',function(a){var e=i===c.serialize();d.removeClass('saved');b.attr('disabled',e).text(f);});b.on('click',$.proxy(function(a){a.preventDefault();a.stopPropagation();d.addClass('saving');b.text(g);this._ajaxSubmitForm(c).done(function(){setTimeout(function(){i=c.serialize();d.removeClass('saving').addClass('saved');b.text(h);},1000);}).fail($.proxy(function(a){var e=a||{};for(var g in e)this._addErrorToInput(c.find(':input[name='+g+']'),e[g]);d.removeClass('saving');b.text(f);},this));return false;},this));},_reloadEmbedIframe:function(){var a=$('#settings-embed-iframe');if(!a.length)return;var b=a.attr('src');var c=Math.round(new Date().getTime()/1000);var d=(b.indexOf('?')>-1)?b.slice(b.indexOf('?')+1).split('&'):[];var e=b.split('?')[0]+'?';for(var f=0;f<d.length;f++)if(d[f].indexOf('ts=')<0)e+=d[f]+'&';a.attr('src',e+'ts='+c);},_preloadImage:function(a){var b=$.Deferred();if(!a)b.reject();else{var c=new Image();c.onload=function(){b.resolve();};c.src=a;}return b.promise();},initializeFormEvents:function(){var a=$("form button.save");var b=$(".settings-toggle");var c=$("#id_username");var d=$("#user_url_text");var e=$('#id_about_bio');e.height(e.get(0).scrollHeight);if(c.length)c.on('input',function(a){var b=c.val();d.text(b);});Giphy.Events.on('toggleinput:toggle',function(a,b,c){var d=$(b);var e=$('input[name='+d.data('input')+']');var f=d.data('inverse-toggle')||false;c=c||false;if(e.length)f?e.val(!c):e.val(c);this._ajaxSubmitForm(window.settingsForm).done($.proxy(function(){if(d.data('input')==='suppress_chrome')this._reloadEmbedIframe();},this));},this);a.each($.proxy(function(a,b){this._bindSaveButtonEvents(b);},this));},addEditGifLinks:function(){var a=$(".user-search-results");if(a.length)$.each($(".a-gif").not(".editLink").not(".no-edit"),function(a,b){var c=$(b),d="/gifs/"+c.attr("data-id")+"/edit/",e=$("<a></a>").addClass("button small transparent-background edit-image").attr("href",d).html("EDIT");c.addClass("editLink");c.attr("href",d);c.after(e);});},addEditBanner:function(){var a=$(".banner img").not("#settings-banner");if(a.length){var b=$("<a></a>").addClass("small button transparent-background edit-image").attr("href","/dashboard/").html("EDIT");a.after(b);}},userSettingsInit:function(){var a=$('#channel-settings-form');if(a.length){window.settingsForm=a;Giphy.UserEdit.uploadNewBanner();Giphy.UserEdit.uploadNewAvatar();Giphy.UserEdit.resetAvatar();Giphy.UserEdit.initializeFormEvents();Giphy.UserEdit.resizeEmbedGif();Giphy.UserEdit.jazzText();if(Giphy.SettingsTourGuide)Giphy.SettingsTourGuide.initialize();}},jazzText:function(){var a=$('#dashboard-banner-text.jazz-text');if(!a.length)return;var b=a.text().split('');a.html('');for(var c=0;c<b.length;c++){var d=$('<span class="dancing-text">'+b[c]+'</span>');a.append(d);}},uploadNewBanner:function(){var a=$('#upload-banner-button');var b=$('#remove-banner-button');var c=$('#id_banner_image');var d=$('#settings-banner');var e=$('#id_is_remove_banner');var f=a.closest('.settings-field');var g=a.closest('.form-row');var h=c.attr('name');var i=a.text();var j=function(){f.removeClass('saving');a.text(i);};a.on('click',$.proxy(function(a){a.preventDefault();c.click();},this));b.on('click',$.proxy(function(a){a.preventDefault();g.addClass('no-banner');d.css('background-image','none');e.val(true);this._ajaxSubmitForm(window.settingsForm).done(function(){e.val(false);});},this));c.on('change',$.proxy(function(b){var e=c.get(0).files;f.addClass('saving');a.text('Uploading');this._ajaxSubmitForm(window.settingsForm).done($.proxy(function(a){var b=a.result;this._preloadImage(b.banner_image).done(function(){d.css('background-image','url('+b.banner_image+')');g.removeClass('no-banner');j();});},this)).fail(function(a){a=a||{};j();if(window.showError&&a[h])window.showError(a[h],6000);});},this));},uploadNewAvatar:function(){var a=$('#upload-avatar');var b=$('#id_avatar');var c=a.find('.upload-label');var d=$('#header .avatar');var e=b.attr('name');var f=c.text();var g=function(){a.removeClass('uploading');c.text(f);};a.on('click',function(a){a.preventDefault();b.click();});b.on('change',$.proxy(function(){a.addClass('uploading');c.text('Uploading');this._ajaxSubmitForm(window.settingsForm).done($.proxy(function(b){var c=b.result;this._preloadImage(c.avatar).done(function(){g();a.css('background-image','url('+c.avatar+')');if(d.length)d.css('background-image','url('+c.avatar+')');});},this)).fail(function(a){a=a||{};g();if(window.showError&&a[e])window.showError(a[e],6000);});},this));},resetAvatar:function(){},showSettingsExampleModal:function(){$('#guide-text').click(function(a){$('#metadata-example').modal({closeText:'',zIndex:100});});},resizeEmbedGif:function(){var a=$('#settings-embed-iframe');if(a.length){var b=a.data();var c=a.width()/b.imagewidth;a.height(b.imageheight*c);}},resetListner:function(){var a=$('.reset');a.click(function(a){$(this).siblings('.reset-input').prop('checked',true);if(a.target.form)setTimeout(function(){a.target.form.submit();},200);});}};})(window,Giphy);(function(a){var b={__scroll:function(){var a=this.$messages.not('[data-seen="true"]');this.windowScrollTop=this.$win.scrollTop();if(a.length)a.each($.proxy(function(a,b){$(b).attr('data-seen',this._isInViewport(b));},this));else{this.remove();this.markAsSeen();}},__resize:function(){this.windowHeight=this.$win.height();},_isInViewport:function(a){var b=$(a);var c=b.offset().top+b.height()+100;return c-this.windowScrollTop<this.windowHeight;},initialize:function(a){a=a||{};if(!window.giphyMessages)return;this.id=window.giphyMessages.id;this.messages=window.giphyMessages.messages;this.isSeen=false;this.windowHeight=0;this.windowScrollTop=0;this.endpoint='/ajax/seenmessages/';this.$el=$(a.el||'#account-settings');this.$body=$('body');this.$win=$(window);this.$messages=$();if(this.messages)this.render();},render:function(){for(var b in this.messages){var c=this.messages[b];var d=$('.settings-toggle[data-input='+c.element+'], :input[name='+c.element+']').filter(':visible');if(d.length){var e=a.Utils.showInputMessage(d,c.message);this.$messages=this.$messages.add(e);}}this.windowHeight=this.$win.height();this.windowScrollTop=this.$win.scrollTop();this.$win.on('scroll.settingsTourGuide',$.proxy(this.__scroll,this));this.$win.on('resize.settingsTourGuide',$.proxy(this.__resize,this));},markAsSeen:function(){$.ajax({url:this.endpoint,type:'POST',data:{message_id:this.id}});},remove:function(){this.$win.off('.settingsTourGuide');}};a.SettingsTourGuide=b;})(Giphy);(function(){var a=Giphy.Utils={fadeMessages:function(a){$(document).ready(function(){setTimeout(function(){$('.flash').fadeOut('slow');},a||2000);});},canPlayMP4:function(){return !!document.createElement('video').canPlayType('video/mp4; codecs=avc1.42E01E,mp4a.40.2');},getParameterByName:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return c==null?"":decodeURIComponent(c[1].replace(/\+/g," "));},hideLogo:function(){$("#logo-image").hide();},checkLogin:function(){if(window.LOGGED_IN)return true;return false;},log:function(a){if(window.console)console.log(a);return;},timeout:function(){var a=null;var b=null;var c=0;var d=[];var e=false;var f=false;this.init=function(h,i,j){var k;if(e)return false;if(!h)return false;if(!i)return false;a=h;b=i;e=true;f=false;c=j?j:0;d=[];for(k=3;k<arguments.length;k++)d[d.length]=arguments[k];setTimeout(g,b);};this.cancel=function(){f=true;e=false;c=0;};function g(){e=false;if(f)return;a.apply(null,d);if(c>0){c--;setTimeout(g,b);}}},showInputMessage:function(a,b,c,d){$input=$(a);b=b||'';c=c||false;d=d||false;if(!$input.length||!b.length||$input.hasClass('message'))return;var e=$input.position();var f=$('<div class="input-message"></div>');var g=function(){f.trigger('removed').remove();$(this).removeClass('message error').off('.input-message');};f.toggleClass('error',c).html(b).css({minHeight:($input.hasClass('settings-toggle'))?'':$input.outerHeight(),left:e.left+$input.outerWidth(),top:e.top});$input.addClass('message').toggleClass('error',c).after(f).one('removemessage.input-message',g);if(!d)if($input.is(':input'))$input.one('input.input-message',g);else $input.one('click.input-message',g);return f;},removeInputMessage:function(a){$input=$(a);$input.trigger('removemessage');},getScrollbarWidth:function(){var a=0;var b=document.createElement('div');b.style.height=100;b.style.width=100;b.style.overflow='scroll';document.body.appendChild(b);a=b.offsetWidth-b.clientWidth;document.body.removeChild(b);return a;}};var b=3000;window.showSuccess=function(a,c,d){if(typeof d!=='undefined')var e=d;else var e=b;var f=$("<div>");$(f).addClass("flash");$(f).addClass("success");$(f).text(a);$("#messages").append(f);setTimeout(function(){if(typeof c!=='undefined')document.location.pathname=c;f.fadeOut('slow');},e);};window.showFancyMessage=function(a,b){var c=$("<div>");$(c).addClass("flash");$(c).addClass("fancy");$(c).text(a);$("#messages").append(c);Giphy.Utils.fadeMessages(b);};window.showError=function(a,b){var c=$("<div>");$(c).addClass("flash");$(c).addClass("error");$(c).text(a);$("#messages").append(c);Giphy.Utils.fadeMessages(b);};})(window,Giphy);$(function(){$(document).ready(function(){if(!$(".gif-detail").length>0)return;var a=document.URL.split('gifs');a.shift();var b=$("#related-container");if(b.length){var c=a.join('gifs').split('?')[0].replace("tile","").replace("fullscreen","").replace(/\//g,'').replace('#','').replace('edit','').replace("#_=_","").replace("_=_","");var d="/gifs/"+c+"/related";$.get(d,function(a){var c=$(a);c.children(':gt(5)').remove();b.html(c);Giphy.Homepage.attachHovers();});}if(Giphy.GifDetail)Giphy.GifDetail.initialize();});});$(function(){$(document).ready(function(){Giphy.Etc.init();if($(".fb_container").length===0)Giphy.Etc.checkLogin({success:function(){var a=$("#default-nav");if(a.length)$.get("/ajax/userheader/?parent="+location.href,function(a){$("#default-nav").replaceWith(a);$("#default-nav").show();Giphy.UserEdit.userSettingsInit();var b=$("#login-button");if(b.length&&window.LOGIN_NEXT){var c=b.attr("href");b.attr("href",c+"?next="+window.LOGIN_NEXT);}var d=Giphy.Utils.getParameterByName('ref');if(d=='fave'){console.log('calling favs');var e=$("#share-heart");if(e.length)e.trigger('click');}});}});Giphy.Globals.initialize();if(Giphy.UserChannel)Giphy.UserChannel.initialize();Giphy.Images.preloadImages();Giphy.Backgrounds.setRandomBackground();Giphy.Login.facebook();Giphy.Favorites.nav();Giphy.Search.init();Giphy.Search.initMini();Giphy.Browsebar.init();Giphy.Browsebar.attachBrowsebarHovers();Giphy.Images.attachHovers();Giphy.Images.sizeImagesToFrame();if(Giphy.Utils.getParameterByName('hideLogo')=='true')Giphy.Utils.hideLogo();if(Giphy.Utils.getParameterByName('status')&&Giphy.Utils.getParameterByName('message')){var a={"uploaded":"GIF uploaded successfully! It's been added to your channel page.","welcome":"Welcome To Giphy!","login":"You are now logged in.","userexists":"That email address has already been registered. Did you forget your password?","twautherror":"Looks like Twitter is experiencing technical difficulties. Please try again.","fbautherror":"Looks like Facebook is experiencing technical difficulties. Please try again.","gifdeleted":"Your GIF has been deleted."},b=Giphy.Utils.getParameterByName('message');if(parseInt(Giphy.Utils.getParameterByName('status'),10)==200)(b==='welcome')?showFancyMessage(a[b],5000):showSuccess(a[b]);else showError(a[b]);}});});$(function(){$(document).ready(function(){if(!$("#homepage").length>0)return;Giphy.Nav.share();Giphy.Nav.attachFooter();Giphy.Homepage.init();});});$(function(){$(document).ready(function(){if(!$("#user-login").length>0)return;Giphy.Login.loginFocus();});});$(function(){$(document).ready(function(){if(!$(".post-content").length>0)return;Giphy.Sharing.shortURLs();Giphy.Sharing.attachShareTools();Giphy.Sharing.attachSharingAnalytics();Giphy.Overlays.addOverlayToGifDetail();Giphy.Overlays.sizeFSOverlay();$('.post-content iframe').each(function(){var a=parseInt($(this).css('width').replace('px',''));var b=parseInt($(this).css('height').replace('px',''));var c=643;var d=(c*b)/a;$(this).css('height',d+'px');$(this).css('width',c+'px');});var a=document.URL.split('posts');a.shift();var b=a.join('posts').split('?')[0].replace('/','').replace('#','');var c="/posts/related/gifs/"+b;var d=$("#post-detail").data("post_id");var e="/posts/related/posts/"+d;e=e.replace("//","/");$(document).on('scroll',function(){$("iframe").each(function(){var a=document.createElement('a');a.href=$(this).attr('src');if(a.protocol==document.location.protocol&&a.hostname==document.location.hostname){var b=$(this).contents().find('#gif');if(($(this).offset().top<=$(window).height()+$(window).scrollTop())&&($(this).offset().top+$(this).height()>=$(window).scrollTop())){if($(b).attr('src')!=$(b).attr('data-animated'))$(b).attr('src',$(b).attr('data-animated'));}else if($(b).attr('src')!=$(b).attr('data-still'))$(b).attr('src',$(b).attr('data-still'));}});});});});$(function(){$(document).ready(function(){if(!$("#searchresults").length>0)return;Giphy.Analytics.trackSearchResultsView();Giphy.SearchResults.attachInfiniteScroll();Giphy.Images.sizeImages();Giphy.Images.attachHovers();});});$(function(){$(document).ready(function(){if(!$(".upload-page").length>0)return;Giphy.Upload.initPUpload();});});